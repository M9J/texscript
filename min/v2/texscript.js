"use strict";(()=>{var we=Object.defineProperty;var K=t=>{throw TypeError(t)};var g=(t,e)=>()=>(t&&(e=t(t=0)),e);var E=(t,e)=>{for(var s in e)we(t,s,{get:e[s],enumerable:!0})};var W=(t,e,s)=>e.has(t)||K("Cannot "+s);var R=(t,e,s)=>(W(t,e,"read from private field"),s?s.call(t):e.get(t)),w=(t,e,s)=>e.has(t)?K("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),y=(t,e,s,i)=>(W(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s);var Y={};E(Y,{default:()=>u});var ye,u,k=g(()=>{"use strict";ye={ERR0001:"Unable to find the raw code to be compiled",ERR0002:"'rawCode' not provided",ERR0003:'Make sure the code is wrapped in &lt;script type="text/texscript">...&lt;/script&gt;',ERR0004:"'codeLOC' not provided",ERR0005:"'rule' not provided",ERR0006:"'matches' not provided",ERR0007:"'tokens' not provided",ERR0008:"token.type is null",ERR0009:"'ast' is not provided",ERR0010:"'node' is not provided",ERR0011:"'lang' is not provided",ERR0012:"Code generator for mentioned language is not provided",ERR0013:"'metricsName' not provided",ERR0014:"Unable to find any code written in Texscript",ERR0015:"Not able to find any Texscript code inside &lt;script&gt; element",ERR0016:"&lt;script&gt; element not found",ERR0017:"Compilation failed",ERR0018:"Dependency not found",ERR0019:"Unable to find any Texscript source URL inside &lt;script&gt; element",ERR0020:'Texscript code should be provided inside &lt;script type="text/texscript">...&lt;/script&gt; or as URL using &lt;script src="file.txs" type="text/texscript">&lt;/script&gt;'},u=ye});var N,A,M,h,C=g(()=>{"use strict";k();h=class{constructor(e){w(this,N,null);w(this,A,null);w(this,M,null);if(!e)throw new Error(u.ERR0013);y(this,N,e)}start(){y(this,A,performance.now())}end(){y(this,M,performance.now());let e=this.getFormattedTime();console.log(`[Texscript: Metrics] > ${R(this,N)} finished in ${e}`)}getTotalTimeMilliseconds(){return R(this,M)&&R(this,A)?R(this,M)-R(this,A):0}getFormattedTime(){let e=this.getTotalTimeMilliseconds();return e<1e3?`${e.toFixed(3)}ms`:`${(e/1e3).toFixed(3)}s`}};N=new WeakMap,A=new WeakMap,M=new WeakMap});var q={};E(q,{findCodeFromDOM:()=>Ae});async function Ae(){try{let t=[],e=document.querySelectorAll('script[type="text/texscript"]');if(!e)throw new Error(u.ERR0003);if(e.length>1)for(let n of Array.from(e)){let r=await Q(n);r&&t.push(r)}else{let n=e[0];if(n){let r=await Q(n);r&&t.push(r)}}if(!(t.length>0))throw new Error(u.ERR0014);return t.join(`
`)}catch(t){p(t,"error")}}async function Q(t){var r;if(!t)throw new Error(u.ERR0016);let e=(r=t.innerText)!=null?r:null,s=t.getAttribute("src");if(!e&&!s)throw new Error(u.ERR0020);let i=null,n=null;if(e&&(i=e.trim(),!i))throw new Error(u.ERR0014);if(s&&(n=(await(await fetch(s)).text()).trim(),!n))throw new Error(u.ERR0014);if(i&&n)return`${i}
${n}`;if(i)return i;if(n)return n}var V=g(()=>{"use strict";k();b()});var X={};E(X,{loadTexscriptStyles:()=>Me});async function Me(){let t=document.querySelector('script[src$="texscript.js"]');if(t instanceof HTMLScriptElement&&t.src){let e=t.src.replace("texscript.js","texscript.css");await be(e),await Le()}}async function be(t){try{let e=await fetch(t);if(e){let s=await e.text();if(s){let i=document.createElement("style");i.innerHTML=s,document.head.appendChild(i)}}}catch(e){p(e,"error")}}async function Le(){let t=document.createElement("meta");t.setAttribute("name","viewport"),t.setAttribute("content","width=device-width, initial-scale=1.0"),document.head.appendChild(t)}var Z=g(()=>{"use strict";b()});var _,L,B,v,$,O,J=g(()=>{"use strict";L=class{constructor(e){w(this,_,null);y(this,_,e)}getNodeType(){return R(this,_)}};_=new WeakMap;B=class extends L{constructor(){super("ROOT");this.value=null;this.meta={};this.body=[];this.dependencies={};this.references={};this.configurations={}}},v=class extends L{constructor(){super("TAG");this.value=null;this.htmlElement=null;this.customCSSClasses=[];this.parameters=null;this.children=[]}},$=class extends L{constructor(){super("LITERAL");this.value=null}},O=class extends L{constructor(){super("SPEC_TAG");this.htmlElement=null;this.value=null}}});function Fe(t,e){let s=new Map;for(let i of t){let n=i.split("|").map(c=>{let o=e[c];if(!o)throw new Error(`Unknown token: ${c}`);return o.source}),r=new RegExp(n.join(""));s.set(i,r)}return s}var ve,Pe,ke,Ne,Oe,_e,ee,te=g(()=>{"use strict";ve={KEYWORD:/(^[A-Z][a-z]*)/,STRING:/"(.*)"$|(\\\"(.*)\\\"$)/},Pe={CSS_CLASS:/\.([a-z]+[a-zA-Z]*)/,COMMAND:/(@[A-Z][a-zA-Z]*\s[\s\w]+:\s*("[^"]*"|\w+))/,PARAMETERS:/(\(([\s\w]+:\s*("[^"]*"|\w+),?\s*)+\))/},ke={BRACKET_SQUARE_CLOSE:/(\])/,BRACKET_SQUARE_OPEN:/(\[)/,COLON:/(:)/,SPACE:/(\s)/,SPACE_OPTIONAL:/(\s)/},Ne={BR:/(::)/,HR:/(--)/},Oe={...ve,...Pe,...ke,...Ne},_e=["BR","BRACKET_SQUARE_CLOSE","COMMAND","HR","KEYWORD|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|CSS_CLASS|SPACE|PARAMETERS|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|SPACE|PARAMETERS|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|SPACE|PARAMETERS","KEYWORD|SPACE|PARAMETERS|COLON|SPACE|STRING","KEYWORD|SPACE|PARAMETERS|SPACE|BRACKET_SQUARE_OPEN","STRING"];ee=Fe(_e,Oe)});var T,se=g(()=>{"use strict";T=class{constructor(){this.items=[]}push(e){this.items.push(e)}pop(){if(this.isEmpty())throw new Error("Stack underflow");return this.items.pop()}isEmpty(){return this.items.length===0}size(){return this.items.length}peek(){return this.isEmpty()?null:this.items[this.items.length-1]}}});var re={};E(re,{default:()=>G});var G,ie=g(()=>{"use strict";C();k();J();te();se();G=class{constructor(){this.version="v0.2";this.repourl="https://github.com/M9J/texscript.git";this.metricsCompilation=new h("Texscript Compilation");this.metricsCodeGeneration=new h("Texscript Code Generation");this.rawCode=null;this.loc=null;this.tokens=null;this.ast=null;console.log(`[Texscript: Info] > Compiler ${this.version}`)}get lastCompilation(){return new Map([["loc",this.loc],["tokens",this.tokens],["ast",this.ast]])}toString(){return{version:this.version,repoURL:this.repourl,lastCompilation:this.lastCompilation}}compile(e){this.rawCode=e,this.metricsCompilation.start(),this.loc=this.convertToLinesOfCode(),this.tokens=this.lexicalAnalysis(),this.ast=this.syntaxAnalysis(),this.metricsCompilation.end()}generateCodeFor(e){if(!e)throw new Error(u.ERR0011);this.metricsCodeGeneration.start();let s=null;if(e==="HTML")s=this.generateCodeForHTML();else throw new Error(u.ERR0012);return this.metricsCodeGeneration.end(),s}generateCodeForHTML(){if(!this.ast)throw new Error(u.ERR0009);let e="";for(let s of this.ast.body){let i=s.getNodeType();(i==="TAG"||i==="SPEC_TAG"||i==="LITERAL")&&(e+=this.generateHTMLForNode(s))}return e.trim()}generateHTMLForNode(e){if(!e)throw new Error(u.ERR0010);let s=e.getNodeType(),i=e.value,n=e.htmlElement,r=e.parameters,c=e.customCSSClasses,o=e.children||[],l="",a="";if(Array.isArray(c)&&c.length>0&&(l=` ${c.join(" ")}`),r)for(let m in r){let d=r[m];a+=` texscript-${i}-${m.toUpperCase()}-${d.toUpperCase()}`}return s==="TAG"?`<${n} class="texscript-${i}${l}${a}">
    ${o.filter(m=>{let d=m.getNodeType();return d==="TAG"||d==="SPEC_TAG"||d==="LITERAL"}).map(m=>this.generateHTMLForNode(m)).join("")}
  </${n}>`:s==="SPEC_TAG"?`<${n} class="texscript-${i}"/>`:s==="LITERAL"?`${i}`:""}syntaxAnalysis(){if(!this.tokens)throw new Error(u.ERR0007);let e=new B;e.value="Program",e.meta.languageName="Texscript",e.meta.languageCompilerVersion=this.version;let s=new T,i=new T,n=new T,r=null;for(let c of this.tokens)for(let o of c){if(!o.type)throw new Error(u.ERR0008);switch(o.type){case"BR":{let l=new O;l.htmlElement="br",l.value="BR",r==null||r.children.push(l);break}case"BRACKET_SQUARE_CLOSE":{s.isEmpty()||s.pop(),s.isEmpty()||(r=s.isEmpty()?null:s.peek());break}case"BRACKET_SQUARE_OPEN":{r&&s.push(r);break}case"COLON":{i.push(o);break}case"COMMAND":{if(o.value){let[l,a]=o.value.split(":");if(l){let[m,d]=l==null?void 0:l.split(" ");if(m&&d&&a){if(m==="@Reference"){let f=a.replace(/[\@\s\"]/g,"");e.references[d]=e.references[d]?[...e.references[d],f]:[f]}else if(m==="@Configure"){let f=a.replace(/[\@\s\"]/g,"");e.configurations[d]=f}}}}break}case"CSS_CLASS":{r==null||r.customCSSClasses.push(o.value);break}case"HR":{let l=new O;l.htmlElement="hr",l.value="HR",r==null||r.children.push(l);break}case"KEYWORD":{let l=new v;if(l.value=o.value,l.htmlElement=o.value==="Section"?"section":o.value==="List"?"ul":"div",r=l,s.isEmpty())if(e.body.length>0){let a=new v;a.value="PageBreak",a.htmlElement="div",a.customCSSClasses=["page-break"],e.body.push(a),e.body.push(r)}else e.body.push(r);else{let a=s.isEmpty()?null:s.peek();a&&a.children.push(r)}break}case"PARAMETERS":{let a=o.value.replace(/[\(\)\s]/g,"").split(",");for(let m of a){let[d,f]=m.split(":");d&&f&&(r!=null&&r.parameters||(r.parameters={}),r.parameters[d]=f)}break}case"SPACE":case"SPACE_OPTIONAL":{n.push(o);break}case"STRING":{let l=new $;l.value=o.value;let a=new v;if(s.isEmpty())a.value="Line",a.htmlElement="div";else{let m=s.isEmpty()?null:s.peek();(m==null?void 0:m.value)==="List"?(a.value="ListItem",a.htmlElement="li"):(a.value="Line",a.htmlElement="div")}if(a.children.push(l),!r)throw new Error("'currentNode' doesn't exist");r.children.push(a),!i.isEmpty()&&!n.isEmpty()&&(r=s.isEmpty()?null:s.peek(),i.pop(),n.pop());break}}}return e}lexicalAnalysis(){if(!this.loc)throw new Error(u.ERR0004);let e=[];for(let[s,i]of this.loc.entries()){let n=!1;for(let[r,c]of ee){let o=i.match(c);if(o&&o.length>0){n=!0;let[l,...a]=o;if(l===i){let m=this.convertLineToTokens(r,a);e.push(m);break}}}if(!n){let r=s+1,c=`${u.ERR0017}, line: ${r}
${i}`;throw new Error(c)}}return e}convertLineToTokens(e,s){if(!e)throw new Error(u.ERR0005);if(!s)throw new Error(u.ERR0006);let i=[],n=e.split("|");for(let[r,c]of n.entries()){let o=s[r];o!==void 0&&i.push({type:c,value:o})}return i}convertToLinesOfCode(){if(!this.rawCode)throw new Error(u.ERR0002);return this.rawCode.split(`
`).map(e=>e.trim()).filter(e=>e.length>0)}}});function D(t){let e=document.createElement("style");e.textContent=t,document.head.appendChild(e)}var F,j=g(()=>{"use strict";C();F=class{constructor(){this.metricsCSSBuilder=new h("CSS Builder");this.CSSConfig={classes:{},globalRules:[]}}addStyle(e,s,i){this.CSSConfig.classes[e]||(this.CSSConfig.classes[e]={}),this.CSSConfig.classes[e][s]=i}addGlobalRule(e){this.CSSConfig.globalRules.push(e)}buildCSS(){this.metricsCSSBuilder.start();let e=Object.entries(this.CSSConfig.classes).map(([i,n])=>{let r=Object.entries(n).map(([c,o])=>`${c}: ${o};`).join(" ");return`${i} { ${r} }`}).join(`
`),s=this.CSSConfig.globalRules.join(`
`);return this.metricsCSSBuilder.end(),`${e}
${s}`}}});var I,ne=g(()=>{"use strict";I={pageSize:"",pagePadding:"",lineHeight:"normal"}});function ae(t,e="mm"){let s=He[t.toUpperCase()];if(!s)return null;switch(e){case"px":return{width:Math.round(s.width*3.779527),height:Math.round(s.height*3.779527)};case"in":return{width:parseFloat((s.width*oe).toFixed(2)),height:parseFloat((s.height*oe).toFixed(2))};case"mm":default:return s}}var oe,He,le=g(()=>{"use strict";oe=.0393701,He={A0:{width:841,height:1189},A1:{width:594,height:841},A2:{width:420,height:594},A3:{width:297,height:420},A4:{width:210,height:297},A5:{width:148,height:210},A6:{width:105,height:148},B0:{width:1e3,height:1414},B1:{width:707,height:1e3},B2:{width:500,height:707},B3:{width:353,height:500},B4:{width:250,height:353},B5:{width:176,height:250},C4:{width:229,height:324},C5:{width:162,height:229},C6:{width:114,height:162}}});async function ce(t){if(t){await Ge(t.pageSize),await $e(t.pagePadding),await Be(t.lineHeight);let e=P.buildCSS();D(e)}}async function Be(t=I.lineHeight){t&&P.addStyle(".texscript-Page","line-height",t)}async function $e(t=I.pagePadding){t&&t&&P.addStyle(".texscript-Page","padding",t)}async function Ge(t=I.pageSize){if(t){let s=ae(t,"in");s&&s.width&&s.height&&(P.addGlobalRule(`@media print { @page { size: ${t}} }`),P.addStyle(".texscript-Page","width",s.width+"in"),P.addStyle(".texscript-Page","height",s.height+"in"))}}var P,pe=g(()=>{"use strict";j();ne();le();P=new F});var De,H,de=g(()=>{"use strict";C();De=["color","display","flex-direction","font-family","font-size","font-weight","justify-content","padding-left","text-align"],H=class{constructor(){this.metricsCSSFilterCompiler=new h("CSS Filter Compiler");this.allowedProperties=De}compile(e){this.metricsCSSFilterCompiler.start();let s={classes:[],imports:[]},i=/@import\s+(?:url\()?["']?([^"')]+)["']?\)?\s*;/g,n;for(;(n=i.exec(e))!==null;){let o=n[1];typeof o=="string"&&o.trim()&&s.imports.push(o.trim())}let r=/((?:\.[a-zA-Z0-9_-]+\s*,?\s*)+)\{([^}]+)\}/g,c;for(;(c=r.exec(e))!==null;){let o=c[1],l=c[2],a=[];l&&l.split(";").forEach(m=>{let[d,f]=m.split(":").map(xe=>xe.trim());this.allowedProperties.includes(d)&&a.push({property:d,value:f})}),o&&o.split(",").map(d=>d.trim()).forEach(d=>{d.startsWith(".")&&s.classes.push({selector:d,declarations:[...a]})})}return this.metricsCSSFilterCompiler.end(),s}generateFilteredCSSContent(e){var n;if(!e)return"";let s=((n=e.imports)==null?void 0:n.map(r=>`@import url("${r}");`))||[],i=e.classes.map(r=>{let c=r.declarations.map(o=>`  ${o.property}: ${o.value};`).join(`
`);return`${r.selector} {
${c}
}`});return[...s,...i].join(`

`)}}});async function ue(t){let e=new h("CSS File Loader");e.start();for(let s of t){let i=await fetch(s);if(i){let n=await i.text();if(n){let r=new H,c=r.compile(n),o=r.generateFilteredCSSContent(c);D(o)}}}e.end()}var me=g(()=>{"use strict";C();j();de()});var ge={};E(ge,{process:()=>Ie});async function Ie(t,e){try{let s=new h("Texscript Process");if(s.start(),p("Compiling..."),t.compile(e),t.ast){let l=t.ast.configurations;l&&(p("Loading configurations..."),await je(l),S("95"));let a=t.ast.references;a&&(p("Loading references..."),await Ue(a),S("98"))}let i=t.generateCodeFor("HTML");p("Compilation done.");let n=document.querySelector(".texscript-banner-container");n instanceof HTMLElement&&(n.style.display="none");let r=document.createElement("div");r.className="texscript-pages",S("100");let c=x();r.innerHTML=i,c.appendChild(r);let o=document.createElement("div");o.className="texscript-pages-container",o.appendChild(r),c.innerHTML=o.outerHTML,s.end(),window.TexscriptCompiler={...t.toString(),toggleSplashStatus:()=>z()},ze()}catch(s){p(s,"error")}}async function Ue(t){if(t)try{let e=t.css;e&&await ue(e)}catch(e){p(e,"error")}}async function je(t){if(t)try{await ce(t)}catch(e){p(e,"error")}}function ze(){(!document.title||document.title.trim()==="")&&(document.title="Texscript | "+location.host+location.pathname);let t=document.documentElement;(!t.lang||t.lang.trim()==="")&&(t.lang="en");let e=document.querySelector('meta[name="description"]');e?(!e.content||e.content.trim()==="")&&(e.content="This page was compiled by Texscript Compiler"):(e=document.createElement("meta"),e.name="description",e.content="This page was compiled by Texscript Compiler",document.head.appendChild(e))}var he=g(()=>{"use strict";U();C();pe();me();b()});var Se={};E(Se,{load:()=>Ke});async function Ke(){try{let t=new h("Texscript Loader");t.start(),p("Getting handy tools..."),S("20");let e=await Promise.resolve().then(()=>(V(),q)),s=await Promise.resolve().then(()=>(Z(),X));p("Opening curse words..."),S("30");let i=await Promise.resolve().then(()=>(k(),Y));p("Applying beauty makeup..."),S("40"),await s.loadTexscriptStyles(),p("Loading brain power..."),S("50");let n=await Promise.resolve().then(()=>(ie(),re)),r=new n.default,c=await Promise.resolve().then(()=>(he(),ge));S("60"),p("Finding your story...");let o=await e.findCodeFromDOM();if(!o)throw new Error(i.default.ERR0001);S("90"),t.end(),c.process(r,o)}catch(t){p(t,"error")}}var fe=g(()=>{"use strict";C();b()});var Re={};E(Re,{hideSplashProgress:()=>Ee,loadSplash:()=>qe,toggleSplashStatus:()=>z,updateSplashProgress:()=>S,updateSplashStatus:()=>p});async function qe(){try{S("8");let t=document.createElement("style");t.innerHTML=Qe,document.head.appendChild(t);let e=document.createElement("div");e.innerHTML=Ye,x().appendChild(e),p("Fetching Texscript Loader...");let i=await Promise.resolve().then(()=>(fe(),Se));S("10"),p("Fetched Texscript Loader"),p("Loading Texscript modules..."),await i.load()}catch(t){p(t,"error")}}function p(t,e){let s="";e==="error"?s=(r=>`<div class="texscript-splash-status-${r}">${t.toString().replaceAll(`
`,"<br/>")}</div>`)("error"):s=`<div>${t}</div>`;let i=document.getElementById("texscript-splash-status");if(i&&(r=>{i.innerHTML+=r})(s),e&&["error"].includes(e)){let n=document.getElementById("texscript-splash");n&&(n.style.display="flex")}e==="error"&&console.error(t)}function z(){let t=document.getElementById("texscript-splash");t&&(t.style.display=t.style.display==="flex"?"none":"flex")}function S(t){if(t){let e=document.getElementById("texscript-splash-progress");e&&e.setAttribute("value",t),parseInt(t)>99&&Ee()}}function Ee(){let t=document.getElementById("texscript-splash-progress");t&&(t.style.display="none")}var We,Ye,Qe,b=g(()=>{"use strict";U();We='Texscript Markup Language [Version 0.2]<br/>Free and Open Source. Licensed under GPL-3.0.<br/>Hosted on GitHub: <a href="https://github.com/M9J/texscript.git">texscript.git</a>',Ye=`
<div class="texscript-splash-container" id="texscript-splash">
  <div class="texscript-banner">
    <div>${We}</div>
    <br/><hr/><br/>
    <div id="texscript-splash-status"></div>
  </div>
</div>
`,Qe=`
.texscript-splash-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;  
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  background: #252529;
  margin: 0;
  box-sizing: border-box;
  display: none;
}

.texscript-banner {
  font-family: monospace;
  background: #fff;
  color: #000;
  padding: 16px;
  box-shadow: -4px -8px 16px rgba(0, 0, 0, 0.5);
  box-sizing: border-box;
}

.texscript-splash-status {
  overflow: auto;
}

.texscript-splash-status-error {
  color: #a00;
}
`});var Ce={};E(Ce,{load:()=>Xe});async function Xe(){let t=x(),e=document.createElement("style");e.innerHTML=Ve,document.head.appendChild(e);let s=document.createElement("progress");s.setAttribute("class","texscript-splash-progress-bar"),s.setAttribute("id","texscript-splash-progress"),s.setAttribute("value","0"),s.setAttribute("max","100"),t.appendChild(s),s.setAttribute("value","2");let i=await Promise.resolve().then(()=>(b(),Re));s.setAttribute("value","5"),await i.loadSplash()}var Ve,Te=g(()=>{"use strict";U();Ve=`
progress.texscript-splash-progress-bar {
  width: 100%;
  height: 4px;
  position: sticky;
  top: 0;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  appearance: none;
  block-size: 4px;
  vertical-align: top;
}

/* Chrome, Safari, Edge */
progress.texscript-splash-progress-bar::-webkit-progress-bar {
  background-color: #252529;
}

/* Firefox */
progress.texscript-splash-progress-bar::-moz-progress-bar {
  background-color: #252529;
}

progress.texscript-splash-progress-bar::-webkit-progress-value {
  background-color: #2196F3;
}

progress.texscript-splash-progress-bar::-webkit-progress-value {
  transition: width 1s ease-in-out;
}
`});function x(){let t=document.querySelector("[data-texscript-host]");return t||document.body}var U=g(()=>{document.addEventListener("DOMContentLoaded",async()=>{if(window.__texscript_loaded__)return;window.__texscript_loaded__=!0;let t=x();t instanceof HTMLElement&&(t.setAttribute("id","TexscriptHostElement"),t.classList.add("reset"),t instanceof HTMLBodyElement||(t.innerHTML=""),t.style.background="#252529",t.style.margin="0px",t.style.padding="0px"),(await Promise.resolve().then(()=>(Te(),Ce))).load()})});U();})();
