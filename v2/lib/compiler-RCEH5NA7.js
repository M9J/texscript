import{a as l}from"./chunk-756GRGXS.js";import{a as R,b as S,c as g}from"./chunk-GKXYOKXO.js";var w,d,A,C=class{constructor(e){S(this,w,null);S(this,d,null);S(this,A,null);if(!e)throw new Error(l.ERR0013);g(this,w,e)}start(){g(this,d,performance.now())}end(){g(this,A,performance.now());let e=this.getFormattedTime();console.log(`[Texscript: Metrics] > ${R(this,w)} finished in ${e}`)}getTotalTimeMilliseconds(){return R(this,A)&&R(this,d)?R(this,A)-R(this,d):0}getFormattedTime(){let e=this.getTotalTimeMilliseconds();return e<1e3?`${e.toFixed(3)}ms`:`${(e/1e3).toFixed(3)}s`}};w=new WeakMap,d=new WeakMap,A=new WeakMap;var v,f=class{constructor(e){S(this,v,null);g(this,v,e)}getNodeType(){return R(this,v)}};v=new WeakMap;var y=class extends f{constructor(){super("ROOT");this.value=null;this.meta={};this.body=[];this.dependencies={}}},L=class extends f{constructor(){super("TAG");this.value=null;this.htmlElement=null;this.customCSSClasses=[];this.parameters=null;this.children=[]}},O=class extends f{constructor(){super("LITERAL");this.value=null}},k=class extends f{constructor(){super("SPEC_TAG");this.htmlElement=null;this.value=null}};var G={KEYWORD:/(^[A-Z][a-z]*)/,STRING:/"(.*)"$|(\\\"(.*)\\\"$)/},b={CSS_CLASS:/\.([a-z]+[a-zA-Z]*)/,EXTERNAL_REFERENCE:/(@[A-Z][a-zA-Z]*:\s".*")/,PARAMETERS:/(\([\s*\w+:\s*\w+,*\s*]*\))/},K={BRACKET_SQUARE_CLOSE:/(\])/,BRACKET_SQUARE_OPEN:/(\[)/,COLON:/(:)/,SPACE:/(\s)/},U={BR:/(::)/,HR:/(--)/},B={...G,...b,...K,...U},F=["BR","BRACKET_SQUARE_CLOSE","HR","KEYWORD|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|CSS_CLASS|SPACE|PARAMETERS|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|SPACE|PARAMETERS|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|SPACE|PARAMETERS|COLON|SPACE|STRING","KEYWORD|SPACE|PARAMETERS|SPACE|BRACKET_SQUARE_OPEN","STRING","EXTERNAL_REFERENCE"];function H(E,e){let s=new Map;for(let n of E){let o=n.split("|").map(i=>{let r=e[i];if(!r)throw new Error(`Unknown token: ${i}`);return r.source}),t=new RegExp(o.join(""));s.set(n,t)}return s}var _=H(F,B);var T=class{constructor(){this.items=[]}push(e){this.items.push(e)}pop(){if(this.isEmpty())throw new Error("Stack underflow");return this.items.pop()}isEmpty(){return this.items.length===0}size(){return this.items.length}peek(){return this.isEmpty()?null:this.items[this.items.length-1]}};var M=class{constructor(){this.version="v0.2";this.repourl="https://github.com/M9J/texscript.git";this.metricsCompilation=new C("Compilation");this.metricsCodeGeneration=new C("Code Generation");this.rawCode=null;this.loc=null;this.tokens=null;this.ast=null;console.log(`[Texscript: Info] > Compiler ${this.version}`)}toString(){return{version:this.version,repoURL:this.repourl,lastCompilation:new Map([["loc",this.loc],["tokens",this.tokens],["ast",this.ast]])}}compile(e){this.rawCode=e,this.metricsCompilation.start(),this.loc=this.convertToLinesOfCode(),this.tokens=this.lexicalAnalysis(),this.ast=this.syntaxAnalysis(),this.metricsCompilation.end()}generateCodeFor(e){if(!e)throw new Error(l.ERR0011);this.metricsCodeGeneration.start();let s=null;if(e==="HTML")s=this.generateCodeForHTML();else throw new Error(l.ERR0012);return this.metricsCodeGeneration.end(),s}generateCodeForHTML(){if(!this.ast)throw new Error(l.ERR0009);let e="";for(let s of this.ast.body){let n=s.getNodeType();(n==="TAG"||n==="SPEC_TAG"||n==="LITERAL")&&(e+=this.generateHTMLForNode(s))}return e.trim()}generateHTMLForNode(e){if(!e)throw new Error(l.ERR0010);let s=e.getNodeType(),n=e.value,o=e.htmlElement,t=e.parameters,i=e.customCSSClasses,r=e.children||[],p="",u="";if(Array.isArray(i)&&i.length>0&&(p=` ${i.join(" ")}`),t)for(let a in t){let h=t[a];u+=` texscript-${n}-${a.toUpperCase()}-${h.toUpperCase()}`}return s==="TAG"?`<${o} class="texscript-${n}${p}${u}">
    ${r.filter(a=>{let h=a.getNodeType();return h==="TAG"||h==="SPEC_TAG"||h==="LITERAL"}).map(a=>this.generateHTMLForNode(a)).join("")}
  </${o}>`:s==="SPEC_TAG"?`<${o} class="texscript-${n}"/>`:s==="LITERAL"?`${n}`:""}syntaxAnalysis(){if(!this.tokens)throw new Error(l.ERR0007);let e=new y;e.value="Program",e.meta.languageName="Texscript",e.meta.languageCompilerVersion=this.version;let s=new T,n=new T,o=new T,t=null;for(let i of this.tokens)for(let r of i){if(!r.type)throw new Error(l.ERR0008);switch(r.type){case"BR":let p=new k;p.htmlElement="br",p.value="BR",t==null||t.children.push(p);break;case"BRACKET_SQUARE_CLOSE":{s.isEmpty()||s.pop(),s.isEmpty()||(t=s.isEmpty()?null:s.peek());break}case"BRACKET_SQUARE_OPEN":t&&s.push(t);break;case"COLON":n.push(r);break;case"CSS_CLASS":t==null||t.customCSSClasses.push(r.value);break;case"EXTERNAL_REFERENCE":if(r.value){let c=r.value.replace(/[\@\s\"]/g,""),[N,x]=c.split(":");N==="CustomCSSFilePath"&&(e.dependencies[N]=x)}break;case"HR":let u=new k;u.htmlElement="hr",u.value="HR",t==null||t.children.push(u);break;case"KEYWORD":let a=new L;if(a.value=r.value,a.htmlElement=r.value==="Section"?"section":r.value==="List"?"ul":"div",t=a,s.isEmpty())e.body.push(t);else{let c=s.isEmpty()?null:s.peek();c&&c.children.push(t)}break;case"PARAMETERS":let $=r.value.replace(/[\(\)\s]/g,"").split(",");for(let c of $){let[N,x]=c.split(":");N&&x&&(t!=null&&t.parameters||(t.parameters={}),t.parameters[N]=x)}break;case"SPACE":o.push(r);break;case"STRING":let P=new O;P.value=r.value;let m=new L;if(s.isEmpty())m.value="Line",m.htmlElement="div";else{let c=s.isEmpty()?null:s.peek();(c==null?void 0:c.value)==="List"?(m.value="ListItem",m.htmlElement="li"):(m.value="Line",m.htmlElement="div")}if(m.children.push(P),!t)throw new Error("'currentNode' doesn't exist");t.children.push(m),!n.isEmpty()&&!o.isEmpty()&&(t=s.isEmpty()?null:s.peek(),n.pop(),o.pop());break}}return e}lexicalAnalysis(){if(!this.loc)throw new Error(l.ERR0004);let e=[];for(let[s,n]of this.loc.entries()){let o=!1;for(let[t,i]of _){let r=n.match(i);if(r&&r.length>0){o=!0;let[p,...u]=r;if(p===n){let a=this.convertLineToTokens(t,u);e.push(a);break}}}if(!o){let t=s+1,i=`${l.ERR0017}, line: ${t}<br/>${n}`;throw new Error(i)}}return e}convertLineToTokens(e,s){if(!e)throw new Error(l.ERR0005);if(!s)throw new Error(l.ERR0006);let n=[],o=e.split("|");for(let[t,i]of o.entries()){let r=s[t];r!==void 0&&n.push({type:i,value:r})}return n}convertToLinesOfCode(){if(!this.rawCode)throw new Error(l.ERR0002);return this.rawCode.split(`
`).map(e=>e.trim()).filter(e=>e.length>0)}};export{M as default};
