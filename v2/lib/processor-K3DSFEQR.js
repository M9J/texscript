import{b as p,c as P,d as u}from"./chunk-OYG4GQPU.js";import{a as y}from"./chunk-YGRGECGB.js";import{a as c}from"./chunk-4ANUUMNB.js";import{a as x}from"./chunk-JRK5XCCK.js";import"./chunk-GKXYOKXO.js";var g=class{constructor(){this.metricsCSSBuilder=new c("CSS Builder");this.CSSConfig={classes:{},globalRules:[]}}addStyle(e,i,o){this.CSSConfig.classes[e]||(this.CSSConfig.classes[e]={}),this.CSSConfig.classes[e][i]=o}addGlobalRule(e){this.CSSConfig.globalRules.push(e)}buildCSS(){this.metricsCSSBuilder.start();let e=Object.entries(this.CSSConfig.classes).map(([o,r])=>{let s=Object.entries(r).map(([a,n])=>`${a}: ${n};`).join(" ");return`${o} { ${s} }`}).join(`
`),i=this.CSSConfig.globalRules.join(`
`);return this.metricsCSSBuilder.end(),`${e}
${i}`}};function C(t){let e=document.createElement("style");e.textContent=t,document.head.appendChild(e)}var f={pageSize:"",pagePadding:"",lineHeight:"normal"};var M=.0393701,b={A0:{width:841,height:1189},A1:{width:594,height:841},A2:{width:420,height:594},A3:{width:297,height:420},A4:{width:210,height:297},A5:{width:148,height:210},A6:{width:105,height:148},B0:{width:1e3,height:1414},B1:{width:707,height:1e3},B2:{width:500,height:707},B3:{width:353,height:500},B4:{width:250,height:353},B5:{width:176,height:250},C4:{width:229,height:324},C5:{width:162,height:229},C6:{width:114,height:162}};function R(t,e="mm"){let i=b[t.toUpperCase()];if(!i)return null;switch(e){case"px":return{width:Math.round(i.width*3.779527),height:Math.round(i.height*3.779527)};case"in":return{width:parseFloat((i.width*M).toFixed(2)),height:parseFloat((i.height*M).toFixed(2))};case"mm":default:return i}}var d=new g;async function T(t){if(t){await _(t.pageSize),await B(t.pagePadding),await L(t.lineHeight);let e=d.buildCSS();C(e)}}async function L(t=f.lineHeight){t&&d.addStyle(".texscript-Page","line-height",t)}async function B(t=f.pagePadding){t&&t&&d.addStyle(".texscript-Page","padding",t)}async function _(t=f.pageSize){if(t){let i=R(t,"in");i&&i.width&&i.height&&(d.addGlobalRule(`@media print { @page { size: ${t}} }`),d.addStyle(".texscript-Page","width",i.width+"in"),d.addStyle(".texscript-Page","height",i.height+"in"))}}var z=["color","display","flex-direction","font-family","font-size","font-weight","justify-content","padding-left","text-align"],m=class{constructor(){this.metricsCSSFilterCompiler=new c("CSS Filter Compiler");this.allowedProperties=z}compile(e){this.metricsCSSFilterCompiler.start();let i={classes:[],imports:[]},o=/@import\s+(?:url\()?["']?([^"')]+)["']?\)?\s*;/g,r;for(;(r=o.exec(e))!==null;){let n=r[1];typeof n=="string"&&n.trim()&&i.imports.push(n.trim())}let s=/((?:\.[a-zA-Z0-9_-]+\s*,?\s*)+)\{([^}]+)\}/g,a;for(;(a=s.exec(e))!==null;){let n=a[1],h=a[2],S=[];h&&h.split(";").forEach(w=>{let[l,E]=w.split(":").map(A=>A.trim());this.allowedProperties.includes(l)&&S.push({property:l,value:E})}),n&&n.split(",").map(l=>l.trim()).forEach(l=>{l.startsWith(".")&&i.classes.push({selector:l,declarations:[...S]})})}return this.metricsCSSFilterCompiler.end(),i}generateFilteredCSSContent(e){var r;if(!e)return"";let i=((r=e.imports)==null?void 0:r.map(s=>`@import url("${s}");`))||[],o=e.classes.map(s=>{let a=s.declarations.map(n=>`  ${n.property}: ${n.value};`).join(`
`);return`${s.selector} {
${a}
}`});return[...i,...o].join(`

`)}};async function F(t){let e=new c("CSS File Loader");e.start();for(let i of t){let o=await fetch(i);if(o.status===404)throw new Error(x.ERR0022+": "+i);let r=await o.text();if(r){let s=new m,a=s.compile(r),n=s.generateFilteredCSSContent(a);C(n)}}e.end()}async function nt(t,e){try{let i=new c("Texscript Process");if(i.start(),p("Compiling..."),t.compile(e),t.ast){let h=t.ast.configurations;h&&(p("Loading configurations..."),await j(h),u("95"));let S=t.ast.references;S&&(p("Loading references..."),await $(S),u("98"))}let o=t.generateCodeFor("HTML");p("Compilation done.");let r=document.querySelector(".texscript-banner-container");r instanceof HTMLElement&&(r.style.display="none");let s=document.createElement("div");s.className="texscript-pages",u("100");let a=y();s.innerHTML=o,a.appendChild(s);let n=document.createElement("div");n.className="texscript-pages-container",n.appendChild(s),a.innerHTML=n.outerHTML,i.end(),window.TexscriptCompiler={...t.toString(),toggleSplashStatus:()=>P()},v()}catch(i){p(i,"error")}}async function $(t){if(t){let e=t.css;e&&await F(e)}}async function j(t){t&&await T(t)}function v(){(!document.title||document.title.trim()==="")&&(document.title="Texscript | "+location.host+location.pathname);let t=document.documentElement;(!t.lang||t.lang.trim()==="")&&(t.lang="en");let e=document.querySelector('meta[name="description"]');e?(!e.content||e.content.trim()==="")&&(e.content="This page was compiled by Texscript Compiler"):(e=document.createElement("meta"),e.name="description",e.content="This page was compiled by Texscript Compiler",document.head.appendChild(e))}export{nt as process};
