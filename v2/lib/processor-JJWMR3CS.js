import{a as c}from"./chunk-ZIMIONYS.js";import{a as x}from"./chunk-JRK5XCCK.js";import{b as p,c as f}from"./chunk-3EPE2HDM.js";import{a as y}from"./chunk-BODBJWK7.js";import"./chunk-GKXYOKXO.js";var h=class{constructor(){this.metricsCSSBuilder=new c("CSS Builder");this.CSSConfig={classes:{},globalRules:[]}}addStyle(e,i,r){this.CSSConfig.classes[e]||(this.CSSConfig.classes[e]={}),this.CSSConfig.classes[e][i]=r}addGlobalRule(e){this.CSSConfig.globalRules.push(e)}buildCSS(){this.metricsCSSBuilder.start();let e=Object.entries(this.CSSConfig.classes).map(([r,o])=>{let s=Object.entries(o).map(([a,n])=>`${a}: ${n};`).join(" ");return`${r} { ${s} }`}).join(`
`),i=this.CSSConfig.globalRules.join(`
`);return this.metricsCSSBuilder.end(),`${e}
${i}`}};function u(t){let e=document.createElement("style");e.textContent=t,document.head.appendChild(e)}var C={pageSize:"",pagePadding:"",lineHeight:"normal"};var P=.0393701,A={A0:{width:841,height:1189},A1:{width:594,height:841},A2:{width:420,height:594},A3:{width:297,height:420},A4:{width:210,height:297},A5:{width:148,height:210},A6:{width:105,height:148},B0:{width:1e3,height:1414},B1:{width:707,height:1e3},B2:{width:500,height:707},B3:{width:353,height:500},B4:{width:250,height:353},B5:{width:176,height:250},C4:{width:229,height:324},C5:{width:162,height:229},C6:{width:114,height:162}};function M(t,e="mm"){let i=A[t.toUpperCase()];if(!i)return null;switch(e){case"px":return{width:Math.round(i.width*3.779527),height:Math.round(i.height*3.779527)};case"in":return{width:parseFloat((i.width*P).toFixed(2)),height:parseFloat((i.height*P).toFixed(2))};case"mm":default:return i}}var d=new h;async function R(t){if(t){await j(t.pageSize),await B(t.pagePadding),await b(t.lineHeight);let e=d.buildCSS();u(e)}}async function b(t=C.lineHeight){t&&d.addStyle(".texscript-Page","line-height",t)}async function B(t=C.pagePadding){t&&t&&d.addStyle(".texscript-PageWrapper","padding",t)}async function j(t=C.pageSize){if(t){let i=M(t,"in");i&&i.width&&i.height&&(d.addGlobalRule(`@media print { @page { size: ${t}} }`),d.addStyle(".texscript-PageWrapper","width",i.width+"in"),d.addStyle(".texscript-PageWrapper","height",i.height+"in"))}}var v=[{href:"https://fonts.googleapis.com",crossorigin:!1},{href:"https://fonts.gstatic.com",crossorigin:!0}];function T(){for(let t of v){let e=document.createElement("link");e.rel="preconnect",e.href=t.href,t.crossorigin&&(e.crossOrigin="anonymous"),document.head.appendChild(e)}}var _=["align-items","color","display","flex-direction","font-family","font-size","font-weight","justify-content","padding-left","text-align"],S=class{constructor(){this.metricsCSSFilterCompiler=new c("CSS Filter Compiler");this.allowedProperties=_}compile(e){this.metricsCSSFilterCompiler.start();let i={classes:[],imports:[]},r=/@import\s+(?:url\()?["']?([^"')]+)["']?\)?\s*;/g,o;for(;(o=r.exec(e))!==null;){let n=o[1];typeof n=="string"&&n.trim()&&i.imports.push(n.trim())}let s=/((?:\.[a-zA-Z0-9_-]+\s*,?\s*)+)\{([^}]+)\}/g,a;for(;(a=s.exec(e))!==null;){let n=a[1],g=a[2],m=[];g&&g.split(";").forEach(w=>{let[l,F]=w.split(":").map(L=>L.trim());this.allowedProperties.includes(l)&&m.push({property:l,value:F})}),n&&n.split(",").map(l=>l.trim()).forEach(l=>{l.startsWith(".")&&i.classes.push({selector:l,declarations:[...m]})})}return this.metricsCSSFilterCompiler.end(),i}generateFilteredCSSContent(e){var o;if(!e)return"";let i=((o=e.imports)==null?void 0:o.map(s=>`@import url("${s}");`))||[],r=e.classes.map(s=>{let a=s.declarations.map(n=>`  ${n.property}: ${n.value};`).join(`
`);return`${s.selector} {
${a}
}`});return[...i,...r].join(`

`)}};async function E(t){let e=new c("CSS File Loader");e.start();for(let i of t){let r=await fetch(i);if(r.status===404)throw new Error(x.ERR0022+": "+i);let o=await r.text();if(o){let s=new S,a=s.compile(o),n=s.generateFilteredCSSContent(a);u(n)}}e.end()}async function rt(t,e){try{let i=new c("Texscript Process");if(i.start(),p("Compiling..."),t.compile(e),t.ast){let g=t.ast.configurations;g&&(p("Loading configurations..."),await O(g),f("95"));let m=t.ast.references;m&&(p("Loading references..."),await z(m),f("98"))}let r=t.generateCodeFor("HTML");p("Compilation done.");let o=document.querySelector(".texscript-banner-container");o instanceof HTMLElement&&(o.style.display="none");let s=document.createElement("div");s.className="texscript-pages";let a=y();s.innerHTML=r;let n=document.createElement("div");n.className="texscript-pages-container",n.classList.add("display-none"),n.appendChild(s),a.innerHTML=n.outerHTML,await document.fonts.ready,n.classList.remove("display-none"),f("100"),i.end(),window.TexscriptCompiler=t.toString(),$()}catch(i){p(i,"error")}}async function z(t){t&&(T(),t.css&&await E(t.css))}async function O(t){t&&await R(t)}function $(){(!document.title||document.title.trim()==="")&&(document.title="Texscript | "+location.host+location.pathname);let t=document.documentElement;(!t.lang||t.lang.trim()==="")&&(t.lang="en");let e=document.querySelector('meta[name="description"]');e?(!e.content||e.content.trim()==="")&&(e.content="This page was compiled by Texscript Compiler"):(e=document.createElement("meta"),e.name="description",e.content="This page was compiled by Texscript Compiler",document.head.appendChild(e))}export{rt as process};
