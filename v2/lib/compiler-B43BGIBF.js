import{a as C}from"./chunk-R4FMO44A.js";import{a as u}from"./chunk-JRK5XCCK.js";import"./chunk-BT22YEBQ.js";import"./chunk-RJQJA35O.js";import{a as N,b as w,c as k}from"./chunk-GKXYOKXO.js";var h,T=class{constructor(e){w(this,h,null);k(this,h,e)}getNodeType(){return N(this,h)}};h=new WeakMap;var d=class extends T{constructor(){super("ROOT");this.value=null;this.meta={};this.body=[];this.dependencies={};this.references={};this.configurations={}}},m=class extends T{constructor(){super("TAG");this.value=null;this.htmlElement=null;this.customCSSClasses=[];this.parameters=null;this.children=[]}},A=class extends T{constructor(){super("LITERAL");this.value=null}},S=class extends T{constructor(){super("SPEC_TAG");this.htmlElement=null;this.value=null}};var L={KEYWORD:/(^[A-Z][a-z]*)/,STRING:/"(.*)"$|(\\\"(.*)\\\"$)/},O={CSS_CLASS:/\.([a-z]+[a-zA-Z]*)/,COMMAND:/(@[A-Z][a-zA-Z]*\s[\s\w]+:\s*("[^"]*"|\w+))/,PARAMETERS:/(\(([\s\w]+:\s*("[^"]*"|\w+),?\s*)+\))/},y={BRACKET_SQUARE_CLOSE:/(\])/,BRACKET_SQUARE_OPEN:/(\[)/,COLON:/(:)/,SPACE:/(\s)/,SPACE_OPTIONAL:/(\s)/},M={BR:/(::)/,HR:/(--)/},P={...L,...O,...y,...M},x=["BR","BRACKET_SQUARE_CLOSE","COMMAND","HR","KEYWORD|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|CSS_CLASS|SPACE|PARAMETERS|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|SPACE|PARAMETERS|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|SPACE|PARAMETERS","KEYWORD|SPACE|PARAMETERS|COLON|SPACE|STRING","KEYWORD|SPACE|PARAMETERS|SPACE|BRACKET_SQUARE_OPEN","STRING"];function _(E,e){let s=new Map;for(let a of E){let l=a.split("|").map(c=>{let o=e[c];if(!o)throw new Error(`Unknown token: ${c}`);return o.source}),t=new RegExp(l.join(""));s.set(a,t)}return s}var v=_(x,P);var g=class{constructor(){this.items=[]}push(e){this.items.push(e)}pop(){if(this.isEmpty())throw new Error("Stack underflow");return this.items.pop()}isEmpty(){return this.items.length===0}size(){return this.items.length}peek(){return this.isEmpty()?null:this.items[this.items.length-1]}};var f=class{constructor(){this.version="v0.2";this.repourl="https://github.com/M9J/texscript.git";this.metricsCompilation=new C("Texscript Compilation");this.metricsCodeGeneration=new C("Texscript Code Generation");this.rawCode=null;this.loc=null;this.tokens=null;this.ast=null;console.log(`[Texscript: Info] > Compiler ${this.version}`)}get lastCompilation(){return new Map([["loc",this.loc],["tokens",this.tokens],["ast",this.ast]])}toString(){return{version:this.version,repoURL:this.repourl,lastCompilation:this.lastCompilation}}compile(e){this.rawCode=e,this.metricsCompilation.start(),this.loc=this.convertToLinesOfCode(),this.tokens=this.lexicalAnalysis(),this.ast=this.syntaxAnalysis(),this.metricsCompilation.end()}generateCodeFor(e){if(!e)throw new Error(u.ERR0011);this.metricsCodeGeneration.start();let s=null;if(e==="HTML")s=this.generateCodeForHTML();else throw new Error(u.ERR0012);return this.metricsCodeGeneration.end(),s}generateCodeForHTML(){if(!this.ast)throw new Error(u.ERR0009);let e="";for(let s of this.ast.body){let a=s.getNodeType();(a==="TAG"||a==="SPEC_TAG"||a==="LITERAL")&&(e+=this.generateHTMLForNode(s))}return e.trim()}generateHTMLForNode(e){if(!e)throw new Error(u.ERR0010);let s=e.getNodeType(),a=e.value,l=e.htmlElement,t=e.parameters,c=e.customCSSClasses,o=e.children||[],r="",n="";if(Array.isArray(c)&&c.length>0&&(r=` ${c.join(" ")}`),t)for(let i in t){let p=t[i];n+=` texscript-${a}-${i.toUpperCase()}-${p.toUpperCase()}`}return s==="TAG"?`<${l} class="texscript-${a}${r}${n}">
    ${o.filter(i=>{let p=i.getNodeType();return p==="TAG"||p==="SPEC_TAG"||p==="LITERAL"}).map(i=>this.generateHTMLForNode(i)).join("")}
  </${l}>`:s==="SPEC_TAG"?`<${l} class="texscript-${a}"/>`:s==="LITERAL"?`${a}`:""}syntaxAnalysis(){if(!this.tokens)throw new Error(u.ERR0007);let e=new d;e.value="Program",e.meta.languageName="Texscript",e.meta.languageCompilerVersion=this.version;let s=new g,a=new g,l=new g,t=null;for(let c of this.tokens)for(let o of c){if(!o.type)throw new Error(u.ERR0008);switch(o.type){case"BR":{let r=new S;r.htmlElement="br",r.value="BR",t==null||t.children.push(r);break}case"BRACKET_SQUARE_CLOSE":{s.isEmpty()||s.pop(),s.isEmpty()||(t=s.isEmpty()?null:s.peek());break}case"BRACKET_SQUARE_OPEN":{t&&s.push(t);break}case"COLON":{a.push(o);break}case"COMMAND":{if(o.value){let[r,n]=o.value.split(":");if(r){let[i,p]=r==null?void 0:r.split(" ");if(i&&p&&n){if(i==="@Reference"){let R=n.replace(/[\@\s\"]/g,"");e.references[p]=e.references[p]?[...e.references[p],R]:[R]}else if(i==="@Configure"){let R=n.replace(/[\@\s\"]/g,"");e.configurations[p]=R}}}}break}case"CSS_CLASS":{t==null||t.customCSSClasses.push(o.value);break}case"HR":{let r=new S;r.htmlElement="hr",r.value="HR",t==null||t.children.push(r);break}case"KEYWORD":{let r=new m;if(r.value=o.value,r.htmlElement=o.value==="Section"?"section":o.value==="List"?"ul":"div",t=r,s.isEmpty())if(e.body.length>0){let n=new m;n.value="PageBreak",n.htmlElement="div",e.body.push(n);let i=new m;i.value="PageWrapper",i.htmlElement="div",i.children.push(t),e.body.push(i)}else{let n=new m;n.value="PageWrapper",n.htmlElement="div",n.children.push(t),e.body.push(n)}else{let n=s.isEmpty()?null:s.peek();n&&n.children.push(t)}break}case"PARAMETERS":{let n=o.value.replace(/[\(\)\s]/g,"").split(",");for(let i of n){let[p,R]=i.split(":");p&&R&&(t!=null&&t.parameters||(t.parameters={}),t.parameters[p]=R)}break}case"SPACE":case"SPACE_OPTIONAL":{l.push(o);break}case"STRING":{let r=new A;r.value=o.value;let n=new m;if(s.isEmpty())n.value="Line",n.htmlElement="div";else{let i=s.isEmpty()?null:s.peek();(i==null?void 0:i.value)==="List"?(n.value="ListItem",n.htmlElement="li"):(n.value="Line",n.htmlElement="div")}if(n.children.push(r),!t)throw new Error("'currentNode' doesn't exist");t.children.push(n),!a.isEmpty()&&!l.isEmpty()&&(t=s.isEmpty()?null:s.peek(),a.pop(),l.pop());break}}}return e}lexicalAnalysis(){if(!this.loc)throw new Error(u.ERR0004);let e=[];for(let[s,a]of this.loc.entries()){let l=!1;for(let[t,c]of v){let o=a.match(c);if(o&&o.length>0){l=!0;let[r,...n]=o;if(r===a){let i=this.convertLineToTokens(t,n);e.push(i);break}}}if(!l){let t=s+1,c=`${u.ERR0017}, line: ${t}
${a}`;throw new Error(c)}}return e}convertLineToTokens(e,s){if(!e)throw new Error(u.ERR0005);if(!s)throw new Error(u.ERR0006);let a=[],l=e.split("|");for(let[t,c]of l.entries()){let o=s[t];o!==void 0&&a.push({type:c,value:o})}return a}convertToLinesOfCode(){if(!this.rawCode)throw new Error(u.ERR0002);return this.rawCode.split(`
`).map(e=>e.trim()).filter(e=>e.length>0)}};export{f as default};
