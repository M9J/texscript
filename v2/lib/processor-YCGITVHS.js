import{a as l}from"./chunk-NL3EVSBU.js";import"./chunk-756GRGXS.js";import{b as c,c as w,d as g}from"./chunk-HEU6KO7C.js";import{a as f}from"./chunk-4B4NJNKO.js";import"./chunk-GKXYOKXO.js";var S=class{constructor(){this.metricsCSSBuilder=new l("CSS Builder");this.CSSConfig={classes:{},globalRules:[]}}addStyle(e,i,s){this.CSSConfig.classes[e]||(this.CSSConfig.classes[e]={}),this.CSSConfig.classes[e][i]=s}addGlobalRule(e){this.CSSConfig.globalRules.push(e)}buildCSS(){this.metricsCSSBuilder.start();let e=Object.entries(this.CSSConfig.classes).map(([s,n])=>{let r=Object.entries(n).map(([o,a])=>`${o}: ${a};`).join(" ");return`${s} { ${r} }`}).join(`
`),i=this.CSSConfig.globalRules.join(`
`);return this.metricsCSSBuilder.end(),`${e}
${i}`}};function m(t){let e=document.createElement("style");e.textContent=t,document.head.appendChild(e)}var C={pageSize:"",pagePadding:"",lineHeight:"1.0"};var y=.0393701,A={A0:{width:841,height:1189},A1:{width:594,height:841},A2:{width:420,height:594},A3:{width:297,height:420},A4:{width:210,height:297},A5:{width:148,height:210},A6:{width:105,height:148},B0:{width:1e3,height:1414},B1:{width:707,height:1e3},B2:{width:500,height:707},B3:{width:353,height:500},B4:{width:250,height:353},B5:{width:176,height:250},C4:{width:229,height:324},C5:{width:162,height:229},C6:{width:114,height:162}};function P(t,e="mm"){let i=A[t.toUpperCase()];if(!i)return null;switch(e){case"px":return{width:Math.round(i.width*3.779527),height:Math.round(i.height*3.779527)};case"in":return{width:parseFloat((i.width*y).toFixed(2)),height:parseFloat((i.height*y).toFixed(2))};case"mm":default:return i}}var d=new S;async function x(t){if(t){await B(t.pageSize),await b(t.pagePadding),await E(t.lineHeight);let e=d.buildCSS();m(e)}}async function E(t=C.lineHeight){t&&d.addStyle(".texscript-Page","line-height",t)}async function b(t=C.pagePadding){t&&t&&d.addStyle(".texscript-Page","padding",t)}async function B(t=C.pageSize){if(t){let i=P(t,"in");i&&i.width&&i.height&&(d.addGlobalRule(`@media print { @page { size: ${t}} }`),d.addStyle(".texscript-Page","width",i.width+"in"),d.addStyle(".texscript-Page","height",i.height+"in"))}}var L=["font-size","font-weight","color","font-family","display","flex-direction","justify-content","text-align"],h=class{constructor(){this.metricsCSSFilterCompiler=new l("CSS Filter Compiler");this.allowedProperties=L}compile(e){this.metricsCSSFilterCompiler.start();let i={classes:[]},s=/\.([a-zA-Z0-9_-]+)\s*\{([^}]+)\}/g,n;for(;(n=s.exec(e))!==null;){let r=`.${n[1]}`,o=n[2],a=[];o&&o.split(";").forEach(p=>{let[u,T]=p.split(":").map(R=>R.trim());this.allowedProperties.includes(u)&&a.push({property:u,value:T})}),a.length>0&&i.classes.push({selector:r,declarations:a})}return this.metricsCSSFilterCompiler.end(),i}generateFilteredCSSContent(e){return e?e.classes.map(i=>{let s=i.declarations.map(n=>`  ${n.property}: ${n.value};`).join(`
`);return`${i.selector} {
${s}
}`}).join(`

`):""}};var M=new l("CSS File Loader");async function F(t){M.start();for(let e of t){let i=await fetch(e);if(i){let s=await i.text();if(s){let n=new h,r=n.compile(s),o=n.generateFilteredCSSContent(r);m(o)}}}M.end()}async function Y(t,e){try{if(c("Compiling..."),t.compile(e),t.ast){let a=t.ast.configurations;a&&(c("Loading configurations..."),await z(a),g("95"));let p=t.ast.references;p&&(c("Loading references..."),await _(p),g("98"))}let i=t.generateCodeFor("HTML");c("Compilation done.");let s=document.querySelector(".texscript-banner-container");s instanceof HTMLElement&&(s.style.display="none");let n=document.createElement("div");n.className="texscript-pages",g("100");let r=f();n.innerHTML=i,r.appendChild(n);let o=document.createElement("div");o.className="texscript-pages-container",o.appendChild(n),r.innerHTML=o.outerHTML,window.TexscriptCompiler={...t.toString(),toggleSplashStatus:()=>w()},$()}catch(i){c(i,"error")}}async function _(t){if(t)try{let e=t.css;e&&await F(e)}catch(e){c(e,"error")}}async function z(t){if(t)try{await x(t)}catch(e){c(e,"error")}}function $(){(!document.title||document.title.trim()==="")&&(document.title="Texscript | "+location.host+location.pathname);let t=document.documentElement;(!t.lang||t.lang.trim()==="")&&(t.lang="en");let e=document.querySelector('meta[name="description"]');e?(!e.content||e.content.trim()==="")&&(e.content="This page was compiled by Texscript Compiler"):(e=document.createElement("meta"),e.name="description",e.content="This page was compiled by Texscript Compiler",document.head.appendChild(e))}export{Y as process};
