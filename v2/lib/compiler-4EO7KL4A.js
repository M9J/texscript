import{a as C}from"./chunk-NL3EVSBU.js";import{a as u}from"./chunk-756GRGXS.js";import{a as N,b as w,c as k}from"./chunk-GKXYOKXO.js";var h,S=class{constructor(e){w(this,h,null);k(this,h,e)}getNodeType(){return N(this,h)}};h=new WeakMap;var A=class extends S{constructor(){super("ROOT");this.value=null;this.meta={};this.body=[];this.dependencies={};this.references={};this.configurations={}}},T=class extends S{constructor(){super("TAG");this.value=null;this.htmlElement=null;this.customCSSClasses=[];this.parameters=null;this.children=[]}},d=class extends S{constructor(){super("LITERAL");this.value=null}},g=class extends S{constructor(){super("SPEC_TAG");this.htmlElement=null;this.value=null}};var v={KEYWORD:/(^[A-Z][a-z]*)/,STRING:/"(.*)"$|(\\\"(.*)\\\"$)/},O={CSS_CLASS:/\.([a-z]+[a-zA-Z]*)/,COMMAND:/(@[A-Z][a-zA-Z]*\s[\s\w]+:\s*("[^"]*"|\w+))/,PARAMETERS:/(\(([\s\w]+:\s*("[^"]*"|\w+),?\s*)+\))/},y={BRACKET_SQUARE_CLOSE:/(\])/,BRACKET_SQUARE_OPEN:/(\[)/,COLON:/(:)/,SPACE:/(\s)/,SPACE_OPTIONAL:/(\s)/},M={BR:/(::)/,HR:/(--)/},x={...v,...O,...y,...M},P=["BR","BRACKET_SQUARE_CLOSE","COMMAND","HR","KEYWORD|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|CSS_CLASS|SPACE|PARAMETERS|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|SPACE|PARAMETERS|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|SPACE|PARAMETERS","KEYWORD|SPACE|PARAMETERS|COLON|SPACE|STRING","KEYWORD|SPACE|PARAMETERS|SPACE|BRACKET_SQUARE_OPEN","STRING"];function _(E,e){let s=new Map;for(let i of E){let l=i.split("|").map(c=>{let o=e[c];if(!o)throw new Error(`Unknown token: ${c}`);return o.source}),t=new RegExp(l.join(""));s.set(i,t)}return s}var L=_(P,x);var m=class{constructor(){this.items=[]}push(e){this.items.push(e)}pop(){if(this.isEmpty())throw new Error("Stack underflow");return this.items.pop()}isEmpty(){return this.items.length===0}size(){return this.items.length}peek(){return this.isEmpty()?null:this.items[this.items.length-1]}};var f=class{constructor(){this.version="v0.2";this.repourl="https://github.com/M9J/texscript.git";this.metricsCompilation=new C("Texscript Compilation");this.metricsCodeGeneration=new C("Texscript Code Generation");this.rawCode=null;this.loc=null;this.tokens=null;this.ast=null;console.log(`[Texscript: Info] > Compiler ${this.version}`)}get lastCompilation(){return new Map([["loc",this.loc],["tokens",this.tokens],["ast",this.ast]])}toString(){return{version:this.version,repoURL:this.repourl,lastCompilation:this.lastCompilation}}compile(e){this.rawCode=e,this.metricsCompilation.start(),this.loc=this.convertToLinesOfCode(),this.tokens=this.lexicalAnalysis(),this.ast=this.syntaxAnalysis(),this.metricsCompilation.end()}generateCodeFor(e){if(!e)throw new Error(u.ERR0011);this.metricsCodeGeneration.start();let s=null;if(e==="HTML")s=this.generateCodeForHTML();else throw new Error(u.ERR0012);return this.metricsCodeGeneration.end(),s}generateCodeForHTML(){if(!this.ast)throw new Error(u.ERR0009);let e="";for(let s of this.ast.body){let i=s.getNodeType();(i==="TAG"||i==="SPEC_TAG"||i==="LITERAL")&&(e+=this.generateHTMLForNode(s))}return e.trim()}generateHTMLForNode(e){if(!e)throw new Error(u.ERR0010);let s=e.getNodeType(),i=e.value,l=e.htmlElement,t=e.parameters,c=e.customCSSClasses,o=e.children||[],r="",n="";if(Array.isArray(c)&&c.length>0&&(r=` ${c.join(" ")}`),t)for(let a in t){let p=t[a];n+=` texscript-${i}-${a.toUpperCase()}-${p.toUpperCase()}`}return s==="TAG"?`<${l} class="texscript-${i}${r}${n}">
    ${o.filter(a=>{let p=a.getNodeType();return p==="TAG"||p==="SPEC_TAG"||p==="LITERAL"}).map(a=>this.generateHTMLForNode(a)).join("")}
  </${l}>`:s==="SPEC_TAG"?`<${l} class="texscript-${i}"/>`:s==="LITERAL"?`${i}`:""}syntaxAnalysis(){if(!this.tokens)throw new Error(u.ERR0007);let e=new A;e.value="Program",e.meta.languageName="Texscript",e.meta.languageCompilerVersion=this.version;let s=new m,i=new m,l=new m,t=null;for(let c of this.tokens)for(let o of c){if(!o.type)throw new Error(u.ERR0008);switch(o.type){case"BR":{let r=new g;r.htmlElement="br",r.value="BR",t==null||t.children.push(r);break}case"BRACKET_SQUARE_CLOSE":{s.isEmpty()||s.pop(),s.isEmpty()||(t=s.isEmpty()?null:s.peek());break}case"BRACKET_SQUARE_OPEN":{t&&s.push(t);break}case"COLON":{i.push(o);break}case"COMMAND":{if(o.value){let[r,n]=o.value.split(":");if(r){let[a,p]=r==null?void 0:r.split(" ");if(a&&p&&n){if(a==="@Reference"){let R=n.replace(/[\@\s\"]/g,"");e.references[p]=e.references[p]?[...e.references[p],R]:[R]}else if(a==="@Configure"){let R=n.replace(/[\@\s\"]/g,"");e.configurations[p]=R}}}}break}case"CSS_CLASS":{t==null||t.customCSSClasses.push(o.value);break}case"HR":{let r=new g;r.htmlElement="hr",r.value="HR",t==null||t.children.push(r);break}case"KEYWORD":{let r=new T;if(r.value=o.value,r.htmlElement=o.value==="Section"?"section":o.value==="List"?"ul":"div",t=r,s.isEmpty())if(e.body.length>0){let n=new T;n.value="PageBreak",n.htmlElement="div",n.customCSSClasses=["page-break"],e.body.push(n),e.body.push(t)}else e.body.push(t);else{let n=s.isEmpty()?null:s.peek();n&&n.children.push(t)}break}case"PARAMETERS":{let n=o.value.replace(/[\(\)\s]/g,"").split(",");for(let a of n){let[p,R]=a.split(":");p&&R&&(t!=null&&t.parameters||(t.parameters={}),t.parameters[p]=R)}break}case"SPACE":case"SPACE_OPTIONAL":{l.push(o);break}case"STRING":{let r=new d;r.value=o.value;let n=new T;if(s.isEmpty())n.value="Line",n.htmlElement="div";else{let a=s.isEmpty()?null:s.peek();(a==null?void 0:a.value)==="List"?(n.value="ListItem",n.htmlElement="li"):(n.value="Line",n.htmlElement="div")}if(n.children.push(r),!t)throw new Error("'currentNode' doesn't exist");t.children.push(n),!i.isEmpty()&&!l.isEmpty()&&(t=s.isEmpty()?null:s.peek(),i.pop(),l.pop());break}}}return e}lexicalAnalysis(){if(!this.loc)throw new Error(u.ERR0004);let e=[];for(let[s,i]of this.loc.entries()){let l=!1;for(let[t,c]of L){let o=i.match(c);if(o&&o.length>0){l=!0;let[r,...n]=o;if(r===i){let a=this.convertLineToTokens(t,n);e.push(a);break}}}if(!l){let t=s+1,c=`${u.ERR0017}, line: ${t}
${i}`;throw new Error(c)}}return e}convertLineToTokens(e,s){if(!e)throw new Error(u.ERR0005);if(!s)throw new Error(u.ERR0006);let i=[],l=e.split("|");for(let[t,c]of l.entries()){let o=s[t];o!==void 0&&i.push({type:c,value:o})}return i}convertToLinesOfCode(){if(!this.rawCode)throw new Error(u.ERR0002);return this.rawCode.split(`
`).map(e=>e.trim()).filter(e=>e.length>0)}};export{f as default};
