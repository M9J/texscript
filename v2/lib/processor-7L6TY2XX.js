import{b as l,c as x,d as C}from"./chunk-G65Z4UPU.js";import{a as y}from"./chunk-4BMQ5IMH.js";import{a as c}from"./chunk-NL3EVSBU.js";import"./chunk-756GRGXS.js";import"./chunk-GKXYOKXO.js";var g=class{constructor(){this.metricsCSSBuilder=new c("CSS Builder");this.CSSConfig={classes:{},globalRules:[]}}addStyle(t,i,o){this.CSSConfig.classes[t]||(this.CSSConfig.classes[t]={}),this.CSSConfig.classes[t][i]=o}addGlobalRule(t){this.CSSConfig.globalRules.push(t)}buildCSS(){this.metricsCSSBuilder.start();let t=Object.entries(this.CSSConfig.classes).map(([o,r])=>{let s=Object.entries(r).map(([a,n])=>`${a}: ${n};`).join(" ");return`${o} { ${s} }`}).join(`
`),i=this.CSSConfig.globalRules.join(`
`);return this.metricsCSSBuilder.end(),`${t}
${i}`}};function u(e){let t=document.createElement("style");t.textContent=e,document.head.appendChild(t)}var f={pageSize:"",pagePadding:"",lineHeight:"normal"};var P=.0393701,A={A0:{width:841,height:1189},A1:{width:594,height:841},A2:{width:420,height:594},A3:{width:297,height:420},A4:{width:210,height:297},A5:{width:148,height:210},A6:{width:105,height:148},B0:{width:1e3,height:1414},B1:{width:707,height:1e3},B2:{width:500,height:707},B3:{width:353,height:500},B4:{width:250,height:353},B5:{width:176,height:250},C4:{width:229,height:324},C5:{width:162,height:229},C6:{width:114,height:162}};function M(e,t="mm"){let i=A[e.toUpperCase()];if(!i)return null;switch(t){case"px":return{width:Math.round(i.width*3.779527),height:Math.round(i.height*3.779527)};case"in":return{width:parseFloat((i.width*P).toFixed(2)),height:parseFloat((i.height*P).toFixed(2))};case"mm":default:return i}}var d=new g;async function T(e){if(e){await B(e.pageSize),await L(e.pagePadding),await b(e.lineHeight);let t=d.buildCSS();u(t)}}async function b(e=f.lineHeight){e&&d.addStyle(".texscript-Page","line-height",e)}async function L(e=f.pagePadding){e&&e&&d.addStyle(".texscript-Page","padding",e)}async function B(e=f.pageSize){if(e){let i=M(e,"in");i&&i.width&&i.height&&(d.addGlobalRule(`@media print { @page { size: ${e}} }`),d.addStyle(".texscript-Page","width",i.width+"in"),d.addStyle(".texscript-Page","height",i.height+"in"))}}var _=["color","display","flex-direction","font-family","font-size","font-weight","justify-content","padding-left","text-align"],m=class{constructor(){this.metricsCSSFilterCompiler=new c("CSS Filter Compiler");this.allowedProperties=_}compile(t){this.metricsCSSFilterCompiler.start();let i={classes:[],imports:[]},o=/@import\s+(?:url\()?["']?([^"')]+)["']?\)?\s*;/g,r;for(;(r=o.exec(t))!==null;){let n=r[1];typeof n=="string"&&n.trim()&&i.imports.push(n.trim())}let s=/((?:\.[a-zA-Z0-9_-]+\s*,?\s*)+)\{([^}]+)\}/g,a;for(;(a=s.exec(t))!==null;){let n=a[1],h=a[2],S=[];h&&h.split(";").forEach(w=>{let[p,R]=w.split(":").map(E=>E.trim());this.allowedProperties.includes(p)&&S.push({property:p,value:R})}),n&&n.split(",").map(p=>p.trim()).forEach(p=>{p.startsWith(".")&&i.classes.push({selector:p,declarations:[...S]})})}return this.metricsCSSFilterCompiler.end(),i}generateFilteredCSSContent(t){var r;if(!t)return"";let i=((r=t.imports)==null?void 0:r.map(s=>`@import url("${s}");`))||[],o=t.classes.map(s=>{let a=s.declarations.map(n=>`  ${n.property}: ${n.value};`).join(`
`);return`${s.selector} {
${a}
}`});return[...i,...o].join(`

`)}};async function F(e){let t=new c("CSS File Loader");t.start();for(let i of e){let o=await fetch(i);if(o){let r=await o.text();if(r){let s=new m,a=s.compile(r),n=s.generateFilteredCSSContent(a);u(n)}}}t.end()}async function et(e,t){try{let i=new c("Texscript Process");if(i.start(),l("Compiling..."),e.compile(t),e.ast){let h=e.ast.configurations;h&&(l("Loading configurations..."),await $(h),C("95"));let S=e.ast.references;S&&(l("Loading references..."),await z(S),C("98"))}let o=e.generateCodeFor("HTML");l("Compilation done.");let r=document.querySelector(".texscript-banner-container");r instanceof HTMLElement&&(r.style.display="none");let s=document.createElement("div");s.className="texscript-pages",C("100");let a=y();s.innerHTML=o,a.appendChild(s);let n=document.createElement("div");n.className="texscript-pages-container",n.appendChild(s),a.innerHTML=n.outerHTML,i.end(),window.TexscriptCompiler={...e.toString(),toggleSplashStatus:()=>x()},j()}catch(i){l(i,"error")}}async function z(e){if(e)try{let t=e.css;t&&await F(t)}catch(t){l(t,"error")}}async function $(e){if(e)try{await T(e)}catch(t){l(t,"error")}}function j(){(!document.title||document.title.trim()==="")&&(document.title="Texscript | "+location.host+location.pathname);let e=document.documentElement;(!e.lang||e.lang.trim()==="")&&(e.lang="en");let t=document.querySelector('meta[name="description"]');t?(!t.content||t.content.trim()==="")&&(t.content="This page was compiled by Texscript Compiler"):(t=document.createElement("meta"),t.name="description",t.content="This page was compiled by Texscript Compiler",document.head.appendChild(t))}export{et as process};
