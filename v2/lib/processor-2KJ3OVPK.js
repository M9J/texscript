import{b as l,c as w,d as m}from"./chunk-WYACEODI.js";import{a as f}from"./chunk-JCLKLLPU.js";import{a as c}from"./chunk-NL3EVSBU.js";import"./chunk-756GRGXS.js";import"./chunk-GKXYOKXO.js";var p=class{constructor(){this.metricsCSSBuilder=new c("CSS Builder");this.CSSConfig={classes:{},globalRules:[]}}addStyle(t,i,s){this.CSSConfig.classes[t]||(this.CSSConfig.classes[t]={}),this.CSSConfig.classes[t][i]=s}addGlobalRule(t){this.CSSConfig.globalRules.push(t)}buildCSS(){this.metricsCSSBuilder.start();let t=Object.entries(this.CSSConfig.classes).map(([s,n])=>{let o=Object.entries(n).map(([a,r])=>`${a}: ${r};`).join(" ");return`${s} { ${o} }`}).join(`
`),i=this.CSSConfig.globalRules.join(`
`);return this.metricsCSSBuilder.end(),`${t}
${i}`}};function C(e){let t=document.createElement("style");t.textContent=e,document.head.appendChild(t)}var u={pageSize:"",pagePadding:"",lineHeight:"1.0"};var y=.0393701,R={A0:{width:841,height:1189},A1:{width:594,height:841},A2:{width:420,height:594},A3:{width:297,height:420},A4:{width:210,height:297},A5:{width:148,height:210},A6:{width:105,height:148},B0:{width:1e3,height:1414},B1:{width:707,height:1e3},B2:{width:500,height:707},B3:{width:353,height:500},B4:{width:250,height:353},B5:{width:176,height:250},C4:{width:229,height:324},C5:{width:162,height:229},C6:{width:114,height:162}};function P(e,t="mm"){let i=R[e.toUpperCase()];if(!i)return null;switch(t){case"px":return{width:Math.round(i.width*3.779527),height:Math.round(i.height*3.779527)};case"in":return{width:parseFloat((i.width*y).toFixed(2)),height:parseFloat((i.height*y).toFixed(2))};case"mm":default:return i}}var d=new p;async function x(e){if(e){await b(e.pageSize),await E(e.pagePadding),await A(e.lineHeight);let t=d.buildCSS();C(t)}}async function A(e=u.lineHeight){e&&d.addStyle(".texscript-Page","line-height",e)}async function E(e=u.pagePadding){e&&e&&d.addStyle(".texscript-Page","padding",e)}async function b(e=u.pageSize){if(e){let i=P(e,"in");i&&i.width&&i.height&&(d.addGlobalRule(`@media print { @page { size: ${e}} }`),d.addStyle(".texscript-Page","width",i.width+"in"),d.addStyle(".texscript-Page","height",i.height+"in"))}}var B=["color","display","flex-direction","font-family","font-size","font-weight","justify-content","padding-left","text-align"],h=class{constructor(){this.metricsCSSFilterCompiler=new c("CSS Filter Compiler");this.allowedProperties=B}compile(t){this.metricsCSSFilterCompiler.start();let i={classes:[]},s=/\.([a-zA-Z0-9_-]+)\s*\{([^}]+)\}/g,n;for(;(n=s.exec(t))!==null;){let o=`.${n[1]}`,a=n[2],r=[];a&&a.split(";").forEach(g=>{let[S,T]=g.split(":").map(F=>F.trim());this.allowedProperties.includes(S)&&r.push({property:S,value:T})}),r.length>0&&i.classes.push({selector:o,declarations:r})}return this.metricsCSSFilterCompiler.end(),i}generateFilteredCSSContent(t){return t?t.classes.map(i=>{let s=i.declarations.map(n=>`  ${n.property}: ${n.value};`).join(`
`);return`${i.selector} {
${s}
}`}).join(`

`):""}};async function M(e){let t=new c("CSS File Loader");t.start();for(let i of e){let s=await fetch(i);if(s){let n=await s.text();if(n){let o=new h,a=o.compile(n),r=o.generateFilteredCSSContent(a);C(r)}}}t.end()}async function Y(e,t){try{let i=new c("Texscript Process");if(i.start(),l("Compiling..."),e.compile(t),e.ast){let g=e.ast.configurations;g&&(l("Loading configurations..."),await _(g),m("95"));let S=e.ast.references;S&&(l("Loading references..."),await L(S),m("98"))}let s=e.generateCodeFor("HTML");l("Compilation done.");let n=document.querySelector(".texscript-banner-container");n instanceof HTMLElement&&(n.style.display="none");let o=document.createElement("div");o.className="texscript-pages",m("100");let a=f();o.innerHTML=s,a.appendChild(o);let r=document.createElement("div");r.className="texscript-pages-container",r.appendChild(o),a.innerHTML=r.outerHTML,i.end(),window.TexscriptCompiler={...e.toString(),toggleSplashStatus:()=>w()},z()}catch(i){l(i,"error")}}async function L(e){if(e)try{let t=e.css;t&&await M(t)}catch(t){l(t,"error")}}async function _(e){if(e)try{await x(e)}catch(t){l(t,"error")}}function z(){(!document.title||document.title.trim()==="")&&(document.title="Texscript | "+location.host+location.pathname);let e=document.documentElement;(!e.lang||e.lang.trim()==="")&&(e.lang="en");let t=document.querySelector('meta[name="description"]');t?(!t.content||t.content.trim()==="")&&(t.content="This page was compiled by Texscript Compiler"):(t=document.createElement("meta"),t.name="description",t.content="This page was compiled by Texscript Compiler",document.head.appendChild(t))}export{Y as process};
