import{a as u}from"./chunk-756GRGXS.js";import{a as m,b as g,c as h}from"./chunk-GKXYOKXO.js";var N,S,d,A=class{constructor(e){g(this,N,null);g(this,S,null);g(this,d,null);if(!e)throw new Error(u.ERR0013);h(this,N,e)}start(){h(this,S,performance.now())}end(){h(this,d,performance.now());let e=this.getFormattedTime();console.log(`[Texscript: Metrics] > ${m(this,N)} finished in ${e}`)}getTotalTimeMilliseconds(){return m(this,d)&&m(this,S)?m(this,d)-m(this,S):0}getFormattedTime(){let e=this.getTotalTimeMilliseconds();return e<1e3?`${e.toFixed(3)}ms`:`${(e/1e3).toFixed(3)}s`}};N=new WeakMap,S=new WeakMap,d=new WeakMap;var k,f=class{constructor(e){g(this,k,null);h(this,k,e)}getNodeType(){return m(this,k)}};k=new WeakMap;var L=class extends f{constructor(){super("ROOT");this.value=null;this.meta={};this.body=[];this.dependencies={};this.references={};this.configurations={}}},C=class extends f{constructor(){super("TAG");this.value=null;this.htmlElement=null;this.customCSSClasses=[];this.parameters=null;this.children=[]}},v=class extends f{constructor(){super("LITERAL");this.value=null}},w=class extends f{constructor(){super("SPEC_TAG");this.htmlElement=null;this.value=null}};var y={KEYWORD:/(^[A-Z][a-z]*)/,STRING:/"(.*)"$|(\\\"(.*)\\\"$)/},x={CSS_CLASS:/\.([a-z]+[a-zA-Z]*)/,COMMAND:/(@[A-Z][a-zA-Z]*\s[\s\w]+:\s*("[^"]*"|\w+))/,PARAMETERS:/(\(([\s\w]+:\s*("[^"]*"|\w+),?\s*)+\))/},P={BRACKET_SQUARE_CLOSE:/(\])/,BRACKET_SQUARE_OPEN:/(\[)/,COLON:/(:)/,SPACE:/(\s)/,SPACE_OPTIONAL:/(\s)/},_={BR:/(::)/,HR:/(--)/},b={...y,...x,...P,..._},$=["BR","BRACKET_SQUARE_CLOSE","COMMAND","HR","KEYWORD|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|CSS_CLASS|SPACE|PARAMETERS|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|SPACE|PARAMETERS|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|SPACE|PARAMETERS","KEYWORD|SPACE|PARAMETERS|COLON|SPACE|STRING","KEYWORD|SPACE|PARAMETERS|SPACE|BRACKET_SQUARE_OPEN","STRING"];function G(E,e){let s=new Map;for(let i of E){let a=i.split("|").map(c=>{let o=e[c];if(!o)throw new Error(`Unknown token: ${c}`);return o.source}),t=new RegExp(a.join(""));s.set(i,t)}return s}var M=G($,b);var T=class{constructor(){this.items=[]}push(e){this.items.push(e)}pop(){if(this.isEmpty())throw new Error("Stack underflow");return this.items.pop()}isEmpty(){return this.items.length===0}size(){return this.items.length}peek(){return this.isEmpty()?null:this.items[this.items.length-1]}};var O=class{constructor(){this.version="v0.2";this.repourl="https://github.com/M9J/texscript.git";this.metricsCompilation=new A("Compilation");this.metricsCodeGeneration=new A("Code Generation");this.rawCode=null;this.loc=null;this.tokens=null;this.ast=null;console.log(`[Texscript: Info] > Compiler ${this.version}`)}get lastCompilation(){return new Map([["loc",this.loc],["tokens",this.tokens],["ast",this.ast]])}toString(){return{version:this.version,repoURL:this.repourl,lastCompilation:this.lastCompilation}}compile(e){this.rawCode=e,this.metricsCompilation.start(),this.loc=this.convertToLinesOfCode(),this.tokens=this.lexicalAnalysis(),this.ast=this.syntaxAnalysis(),this.metricsCompilation.end()}generateCodeFor(e){if(!e)throw new Error(u.ERR0011);this.metricsCodeGeneration.start();let s=null;if(e==="HTML")s=this.generateCodeForHTML();else throw new Error(u.ERR0012);return this.metricsCodeGeneration.end(),s}generateCodeForHTML(){if(!this.ast)throw new Error(u.ERR0009);let e="";for(let s of this.ast.body){let i=s.getNodeType();(i==="TAG"||i==="SPEC_TAG"||i==="LITERAL")&&(e+=this.generateHTMLForNode(s))}return e.trim()}generateHTMLForNode(e){if(!e)throw new Error(u.ERR0010);let s=e.getNodeType(),i=e.value,a=e.htmlElement,t=e.parameters,c=e.customCSSClasses,o=e.children||[],r="",n="";if(Array.isArray(c)&&c.length>0&&(r=` ${c.join(" ")}`),t)for(let l in t){let p=t[l];n+=` texscript-${i}-${l.toUpperCase()}-${p.toUpperCase()}`}return s==="TAG"?`<${a} class="texscript-${i}${r}${n}">
    ${o.filter(l=>{let p=l.getNodeType();return p==="TAG"||p==="SPEC_TAG"||p==="LITERAL"}).map(l=>this.generateHTMLForNode(l)).join("")}
  </${a}>`:s==="SPEC_TAG"?`<${a} class="texscript-${i}"/>`:s==="LITERAL"?`${i}`:""}syntaxAnalysis(){if(!this.tokens)throw new Error(u.ERR0007);let e=new L;e.value="Program",e.meta.languageName="Texscript",e.meta.languageCompilerVersion=this.version;let s=new T,i=new T,a=new T,t=null;for(let c of this.tokens)for(let o of c){if(!o.type)throw new Error(u.ERR0008);switch(o.type){case"BR":{let r=new w;r.htmlElement="br",r.value="BR",t==null||t.children.push(r);break}case"BRACKET_SQUARE_CLOSE":{s.isEmpty()||s.pop(),s.isEmpty()||(t=s.isEmpty()?null:s.peek());break}case"BRACKET_SQUARE_OPEN":{t&&s.push(t);break}case"COLON":{i.push(o);break}case"COMMAND":{if(o.value){let[r,n]=o.value.split(":");if(r){let[l,p]=r==null?void 0:r.split(" ");if(l&&p&&n){if(l==="@Reference"){let R=n.replace(/[\@\s\"]/g,"");e.references[p]=e.references[p]?[...e.references[p],R]:[R]}else if(l==="@Configure"){let R=n.replace(/[\@\s\"]/g,"");e.configurations[p]=R}}}}break}case"CSS_CLASS":{t==null||t.customCSSClasses.push(o.value);break}case"HR":{let r=new w;r.htmlElement="hr",r.value="HR",t==null||t.children.push(r);break}case"KEYWORD":{let r=new C;if(r.value=o.value,r.htmlElement=o.value==="Section"?"section":o.value==="List"?"ul":"div",t=r,s.isEmpty())if(e.body.length>0){let n=new C;n.value="PageBreak",n.htmlElement="div",n.customCSSClasses=["page-break"],e.body.push(n),e.body.push(t)}else e.body.push(t);else{let n=s.isEmpty()?null:s.peek();n&&n.children.push(t)}break}case"PARAMETERS":{let n=o.value.replace(/[\(\)\s]/g,"").split(",");for(let l of n){let[p,R]=l.split(":");p&&R&&(t!=null&&t.parameters||(t.parameters={}),t.parameters[p]=R)}break}case"SPACE":case"SPACE_OPTIONAL":{a.push(o);break}case"STRING":{let r=new v;r.value=o.value;let n=new C;if(s.isEmpty())n.value="Line",n.htmlElement="div";else{let l=s.isEmpty()?null:s.peek();(l==null?void 0:l.value)==="List"?(n.value="ListItem",n.htmlElement="li"):(n.value="Line",n.htmlElement="div")}if(n.children.push(r),!t)throw new Error("'currentNode' doesn't exist");t.children.push(n),!i.isEmpty()&&!a.isEmpty()&&(t=s.isEmpty()?null:s.peek(),i.pop(),a.pop());break}}}return e}lexicalAnalysis(){if(!this.loc)throw new Error(u.ERR0004);let e=[];for(let[s,i]of this.loc.entries()){let a=!1;for(let[t,c]of M){let o=i.match(c);if(o&&o.length>0){a=!0;let[r,...n]=o;if(r===i){let l=this.convertLineToTokens(t,n);e.push(l);break}}}if(!a){let t=s+1,c=`${u.ERR0017}, line: ${t}
${i}`;throw new Error(c)}}return e}convertLineToTokens(e,s){if(!e)throw new Error(u.ERR0005);if(!s)throw new Error(u.ERR0006);let i=[],a=e.split("|");for(let[t,c]of a.entries()){let o=s[t];o!==void 0&&i.push({type:c,value:o})}return i}convertToLinesOfCode(){if(!this.rawCode)throw new Error(u.ERR0002);return this.rawCode.split(`
`).map(e=>e.trim()).filter(e=>e.length>0)}};export{O as default};
