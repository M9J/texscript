var ie=Object.defineProperty;var B=t=>{throw TypeError(t)};var u=(t,e)=>()=>(t&&(e=t(t=0)),e);var R=(t,e)=>{for(var s in e)ie(t,s,{get:e[s],enumerable:!0})};var I=(t,e,s)=>e.has(t)||B("Cannot "+s);var E=(t,e,s)=>(I(t,e,"read from private field"),s?s.call(t):e.get(t)),f=(t,e,s)=>e.has(t)?B("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),T=(t,e,s,n)=>(I(t,e,"write to private field"),n?n.call(t,s):e.set(t,s),s);var K={};R(K,{default:()=>a});var ae,a,S=u(()=>{"use strict";ae={ERR0001:"Unable to find the raw code to be compiled",ERR0002:"'rawCode' not provided",ERR0003:'Make sure the code is wrapped in &lt;script type="text/texscript">...&lt;/script&gt;',ERR0004:"'codeLOC' not provided",ERR0005:"'rule' not provided",ERR0006:"'matches' not provided",ERR0007:"'tokens' not provided",ERR0008:"token.type is null",ERR0009:"'ast' is not provided",ERR0010:"'node' is not provided",ERR0011:"'lang' is not provided",ERR0012:"Code generator for mentioned language is not provided",ERR0013:"'metricsName' not provided",ERR0014:"Unable to find any code written in Texscript",ERR0015:"Not able to find any Texscript code inside &lt;script&gt; element",ERR0016:"&lt;script&gt; element not found",ERR0017:"Compilation failed",ERR0018:"Dependency not found",ERR0019:"Unable to find any Texscript source URL inside &lt;script&gt; element",ERR0020:'Texscript code should be provided inside &lt;script type="text/texscript">...&lt;/script&gt; or as URL using &lt;script src="file.txs" type="text/texscript">&lt;/script&gt;'},a=ae});var D={};R(D,{findCodeFromDOM:()=>le});async function le(){try{let t=[],e=document.querySelectorAll('script[type="text/texscript"]');if(!e)throw new Error(a.ERR0003);if(e.length>1)for(let o of Array.from(e)){let r=await U(o);r&&t.push(r)}else{let o=e[0];if(o){let r=await U(o);r&&t.push(r)}}if(!(t.length>0))throw new Error(a.ERR0014);return t.join(`
`)}catch(t){l(t,"error"),console.log(t)}}async function U(t){var r;if(!t)throw new Error(a.ERR0016);let e=(r=t.innerText)!=null?r:null,s=t.getAttribute("src");if(!e&&!s)throw new Error(a.ERR0020);let n=null,o=null;if(e&&(n=e.trim(),!n))throw new Error(a.ERR0014);if(s&&(o=(await(await fetch(s)).text()).trim(),!o))throw new Error(a.ERR0014);if(n&&o)return`${n}
${o}`;if(n)return n;if(o)return o}var j=u(()=>{"use strict";C();S()});var W={};R(W,{loadTexscriptStyles:()=>ce});async function ce(){let t=document.querySelector('script[src$="texscript.js"]');if(t instanceof HTMLScriptElement&&t.src){let e=t.src.replace("texscript.js","texscript.css");await pe(e),await de()}}async function pe(t){try{let e=await fetch(t);if(e){let s=await e.text();if(s){let n=document.createElement("style");n.innerHTML=s,document.head.appendChild(n)}}}catch(e){l(e,"error"),console.log(e)}}async function de(){let t=document.createElement("meta");t.setAttribute("name","viewport"),t.setAttribute("content","initial-scale=1.0, maximum-scale=1.0, user-scalable=no"),document.head.appendChild(t)}var Y=u(()=>{"use strict";C()});var N,x,w,A,Q=u(()=>{"use strict";S();A=class{constructor(e){f(this,N,null);f(this,x,null);f(this,w,null);if(!e)throw new Error(a.ERR0013);T(this,N,e)}start(){T(this,x,performance.now())}end(){T(this,w,performance.now());let e=this.getFormattedTime();console.log(`[Texscript: Metrics] > ${E(this,N)} finished in ${e}`)}getTotalTimeMilliseconds(){return E(this,w)&&E(this,x)?E(this,w)-E(this,x):0}getFormattedTime(){let e=this.getTotalTimeMilliseconds();return e<1e3?`${e.toFixed(3)}ms`:`${(e/1e3).toFixed(3)}s`}};N=new WeakMap,x=new WeakMap,w=new WeakMap});var b,y,O,k,_,M,z=u(()=>{"use strict";y=class{constructor(e){f(this,b,null);T(this,b,e)}getNodeType(){return E(this,b)}};b=new WeakMap;O=class extends y{constructor(){super("ROOT");this.value=null;this.meta={};this.body=[];this.dependencies={}}},k=class extends y{constructor(){super("TAG");this.value=null;this.htmlElement=null;this.customCSSClasses=[];this.parameters=null;this.children=[]}},_=class extends y{constructor(){super("LITERAL");this.value=null}},M=class extends y{constructor(){super("SPEC_TAG");this.htmlElement=null;this.value=null}}});function fe(t,e){let s=new Map;for(let n of t){let o=n.split("|").map(i=>{let p=e[i];if(!p)throw new Error(`Unknown token: ${i}`);return p.source}),r=new RegExp(o.join(""));s.set(n,r)}return s}var ue,me,Ee,Re,ge,he,V,X=u(()=>{"use strict";ue={KEYWORD:/(^[A-Z][a-z]*)/,STRING:/"(.*)"$|(\\\"(.*)\\\"$)/},me={CSS_CLASS:/\.([a-z]+[a-zA-Z]*)/,EXTERNAL_REFERENCE:/(@[A-Z][a-zA-Z]*:\s".*")/,PARAMETERS:/(\([\s*\w+:\s*\w+,*\s*]*\))/},Ee={BRACKET_SQUARE_CLOSE:/(\])/,BRACKET_SQUARE_OPEN:/(\[)/,COLON:/(:)/,SPACE:/(\s)/},Re={BR:/(::)/,HR:/(--)/},ge={...ue,...me,...Ee,...Re},he=["BR","BRACKET_SQUARE_CLOSE","HR","KEYWORD|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|CSS_CLASS|SPACE|PARAMETERS|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|SPACE|PARAMETERS|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|SPACE|PARAMETERS|COLON|SPACE|STRING","KEYWORD|SPACE|PARAMETERS|SPACE|BRACKET_SQUARE_OPEN","STRING","EXTERNAL_REFERENCE"];V=fe(he,ge)});var g,Z=u(()=>{"use strict";g=class{constructor(){this.items=[]}push(e){this.items.push(e)}pop(){if(this.isEmpty())throw new Error("Stack underflow");return this.items.pop()}isEmpty(){return this.items.length===0}size(){return this.items.length}peek(){if(this.isEmpty())throw new Error("Stack is empty");return this.items[this.items.length-1]}}});var q={};R(q,{default:()=>H});var H,J=u(()=>{"use strict";Q();S();z();X();Z();H=class{constructor(){this.version="v0.2";this.repourl="https://github.com/M9J/texscript.git";this.metricsCompilation=new A("Compilation");this.metricsCodeGeneration=new A("Code Generation");this.rawCode=null;this.loc=null;this.tokens=null;this.ast=null;console.log(`[Texscript: Info] > Compiler ${this.version}`)}toString(){return{version:this.version,repoURL:this.repourl,lastCompilation:new Map([["loc",this.loc],["tokens",this.tokens],["ast",this.ast]])}}compile(e){this.rawCode=e,this.metricsCompilation.start(),this.loc=this.convertToLinesOfCode(),this.tokens=this.lexicalAnalysis(),this.ast=this.syntaxAnalysis(),this.metricsCompilation.end()}generateCodeFor(e){if(!e)throw new Error(a.ERR0011);this.metricsCodeGeneration.start();let s=null;if(e==="HTML")s=this.generateCodeForHTML();else throw new Error(a.ERR0012);return this.metricsCodeGeneration.end(),s}generateCodeForHTML(){if(!this.ast)throw new Error(a.ERR0009);let e="";for(let s of this.ast.body){let n=s.getNodeType();(n==="TAG"||n==="SPEC_TAG"||n==="LITERAL")&&(e+=this.generateHTMLForNode(s))}return e.trim()}generateHTMLForNode(e){if(!e)throw new Error(a.ERR0010);let s=e.getNodeType(),n=e.value,o=e.htmlElement,r=e.parameters,i=e.customCSSClasses,p=e.children||[],h="",c="";if(Array.isArray(i)&&i.length>0&&(h=` ${i.join(" ")}`),r)for(let d in r){let m=r[d];c+=` texscript-${n}-${d.toUpperCase()}-${m.toUpperCase()}`}return s==="TAG"?`<${o} class="texscript-${n}${h}${c}">
    ${p.filter(d=>{let m=d.getNodeType();return m==="TAG"||m==="SPEC_TAG"||m==="LITERAL"}).map(d=>this.generateHTMLForNode(d)).join("")}
  </${o}>`:s==="SPEC_TAG"?`<${o} class="texscript-${n}"/>`:s==="LITERAL"?`${n}`:""}syntaxAnalysis(){var i,p;if(!this.tokens)throw new Error(a.ERR0007);let e=new O;e.value="Program",e.meta.languageName="Texscript",e.meta.languageCompilerVersion=this.version;let s=new g,n=new g,o=new g,r=null;for(let h of this.tokens)for(let c of h){if(!c.type)throw new Error(a.ERR0008);switch(c.type){case"BR":let d=new M;d.htmlElement="br",d.value="BR",r==null||r.children.push(d);break;case"BRACKET_SQUARE_CLOSE":s.isEmpty()||(s.pop(),r=s.isEmpty()?null:s.peek());break;case"BRACKET_SQUARE_OPEN":r&&s.push(r);break;case"COLON":n.push(c);break;case"CSS_CLASS":r==null||r.customCSSClasses.push(c.value);break;case"EXTERNAL_REFERENCE":if(c.value){let F=c.value.replace(/[\@\s\"]/g,""),[L,P]=F.split(":");L==="CustomCSSFilePath"&&(e.dependencies[L]=P)}break;case"HR":let m=new M;m.htmlElement="hr",m.value="HR",r==null||r.children.push(m);break;case"KEYWORD":let $=new k;$.value=c.value,$.htmlElement=c.value==="Section"?"section":c.value==="List"?"ul":"div",r=$,s.isEmpty()?e.body.push(r):(i=s.peek())==null||i.children.push(r);break;case"PARAMETERS":let oe=c.value.replace(/[\(\)\s]/g,"").split(",");for(let F of oe){let[L,P]=F.split(":");L&&P&&(r!=null&&r.parameters||(r.parameters={}),r.parameters[L]=P)}break;case"SPACE":o.push(c);break;case"STRING":let G=new _;G.value=c.value;let v=new k;if(v.value=((p=s.peek())==null?void 0:p.value)==="List"?"ListItem":"Line",v.htmlElement=v.value==="ListItem"?"li":"div",v.children.push(G),!r)throw new Error("'currentNode' doesn't exist");r.children.push(v),!n.isEmpty()&&!o.isEmpty()&&(r=s.peek()||null,n.pop(),o.pop());break}}return e}lexicalAnalysis(){if(!this.loc)throw new Error(a.ERR0004);let e=[];for(let[s,n]of this.loc.entries()){let o=!1;for(let[r,i]of V){let p=n.match(i);if(p&&p.length>0){let[h,...c]=p;if(h===n){let d=this.convertLineToTokens(r,c);e.push(d),o=!0;break}}}if(!o){let r=s+1,i=`${a.ERR0017}, line: ${r}<br/>${n}`;throw new Error(i)}}return e}convertLineToTokens(e,s){if(!e)throw new Error(a.ERR0005);if(!s)throw new Error(a.ERR0006);let n=[],o=e.split("|");for(let[r,i]of o.entries()){let p=s[r];p!==void 0&&n.push({type:i,value:p})}return n}convertToLinesOfCode(){if(!this.rawCode)throw new Error(a.ERR0002);return this.rawCode.split(`
`).map(e=>e.trim()).filter(e=>e.length>0)}}});var ee={};R(ee,{process:()=>Te});async function Te(t,e){try{if(l("Compiling..."),t.compile(e),t.ast){let i=t.ast.dependencies;l("Loading dependencies..."),await Se(i)}let s=t.generateCodeFor("HTML");l("Compilation done.");let n=document.querySelector(".texscript-banner-container");n instanceof HTMLElement&&(n.style.display="none");let o=document.createElement("div");o.className="texscript-pages",o.innerHTML=s;let r=document.createElement("div");r.className="texscript-pages-container",r.appendChild(o),document.body.appendChild(r),window.TexscriptCompiler={...t.toString(),toggleSplash:()=>{let i=document.getElementById("texscript-splash");i&&(i.style.display=i.style.display==="flex"?"none":"flex")}}}catch(s){l(s,"error"),console.log(s)}}async function Se(t){try{if(t!=null&&t.CustomCSSFilePath){let e=t.CustomCSSFilePath;await Ce(e)}}catch(e){l(e,"error"),console.log(e)}}async function Ce(t){let e=document.createElement("link");e.rel="stylesheet",e.href=t;try{document.head.appendChild(e),await new Promise((s,n)=>{e.onload=()=>s(),e.onerror=()=>{let o=a.ERR0018+"<br/>"+t;n(new Error(o))}})}catch(s){l(s,"error"),console.log(s)}}var te=u(()=>{"use strict";C();S()});var se={};R(se,{load:()=>xe});async function xe(){try{l("Getting handy tools...");let t=await Promise.resolve().then(()=>(j(),D)),e=await Promise.resolve().then(()=>(Y(),W));l("Opening curse words...");let s=await Promise.resolve().then(()=>(S(),K));l("Applying beauty makeup..."),await e.loadTexscriptStyles(),l("Loading brain power...");let n=await Promise.resolve().then(()=>(J(),q)),o=new n.default,r=await Promise.resolve().then(()=>(te(),ee));l("Finding your story...");let i=await t.findCodeFromDOM();if(!i)throw new Error(s.default.ERR0001);r.process(o,i)}catch(t){l(t,"error"),console.log(t)}}var re=u(()=>{"use strict";C()});var ne={};R(ne,{loadSplash:()=>ve,updateSplashStatus:()=>l});async function ve(){try{let t=document.createElement("style");t.innerHTML=ye,document.head.appendChild(t),document.body.innerHTML=Ae,l("Fetching Texscript Loader...");let e=await Promise.resolve().then(()=>(re(),se));l("Fetched Texscript Loader"),l("Loading Texscript modules..."),await e.load()}catch(t){l(t,"error"),console.log(t)}}function l(t,e){let s="";e==="error"?s=(r=>`<div class="texscript-splash-status-${r}">${t}</div>`)("error"):s=t;let o=document.getElementById("texscript-splash-status");if(o&&(i=>{o.innerHTML+=i+"<br/>"})(s),e&&["error"].includes(e)){let r=document.getElementById("texscript-splash");r&&(r.style.display="flex")}}var we,Ae,ye,C=u(()=>{"use strict";we='Texscript Markup Language [Version 0.2]<br/>Free and Open Source. Licensed under GPL-3.0.<br/>Hosted on GitHub: <a href="https://github.com/M9J/texscript.git">texscript.git</a>',Ae=`
<div class="texscript-splash-container" id="texscript-splash">
  <div class="texscript-banner">
    <div>${we}</div>
    <br/>
    <div>$&gt; texscript run</div>
    <br/>
    <div id="texscript-splash-status"></div>
  </div>
</div>
`,ye=`
.texscript-splash-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;  
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  background: #252529;
  margin: 0;
  box-sizing: border-box;
  display: none;
}

.texscript-banner {
  font-family: monospace;
  background: #fff;
  color: #000;
  padding: 16px;
  box-shadow: -4px -8px 16px rgba(0, 0, 0, 0.5);
  box-sizing: border-box;
}

.texscript-splash-status {
  overflow: auto;
}

.texscript-splash-status-error {
  color: #a00;
}
`});async function Qe(){await(await Promise.resolve().then(()=>(C(),ne))).loadSplash()}export{Qe as load};
