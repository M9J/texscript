var oe=Object.defineProperty;var G=t=>{throw TypeError(t)};var d=(t,e)=>()=>(t&&(e=t(t=0)),e);var g=(t,e)=>{for(var s in e)oe(t,s,{get:e[s],enumerable:!0})};var B=(t,e,s)=>e.has(t)||G("Cannot "+s);var h=(t,e,s)=>(B(t,e,"read from private field"),s?s.call(t):e.get(t)),S=(t,e,s)=>e.has(t)?G("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),C=(t,e,s,r)=>(B(t,e,"write to private field"),r?r.call(t,s):e.set(t,s),s);var K={};g(K,{default:()=>l});var ie,l,x=d(()=>{"use strict";ie={ERR0001:"Unable to find the raw code to be compiled",ERR0002:"'rawCode' not provided",ERR0003:'Make sure the code is wrapped in &lt;script type="text/texscript">...&lt;/script&gt;',ERR0004:"'codeLOC' not provided",ERR0005:"'rule' not provided",ERR0006:"'matches' not provided",ERR0007:"'tokens' not provided",ERR0008:"token.type is null",ERR0009:"'ast' is not provided",ERR0010:"'node' is not provided",ERR0011:"'lang' is not provided",ERR0012:"Code generator for mentioned language is not provided",ERR0013:"'metricsName' not provided",ERR0014:"Unable to find any code written in Texscript",ERR0015:"Not able to find any Texscript code inside &lt;script&gt; element",ERR0016:"&lt;script&gt; element not found",ERR0017:"Compilation failed",ERR0018:"Dependency not found",ERR0019:"Unable to find any Texscript source URL inside &lt;script&gt; element",ERR0020:'Texscript code should be provided inside &lt;script type="text/texscript">...&lt;/script&gt; or as URL using &lt;script src="file.txs" type="text/texscript">&lt;/script&gt;'},l=ie});var I={};g(I,{findCodeFromDOM:()=>ae});async function ae(){try{let t=[],e=document.querySelectorAll('script[type="text/texscript"]');if(!e)throw new Error(l.ERR0003);if(e.length>1)for(let o of Array.from(e)){let n=await U(o);n&&t.push(n)}else{let o=e[0];if(o){let n=await U(o);n&&t.push(n)}}if(!(t.length>0))throw new Error(l.ERR0014);return t.join(`
`)}catch(t){c(t,"error"),console.log(t)}}async function U(t){var n;if(!t)throw new Error(l.ERR0016);let e=(n=t.innerText)!=null?n:null,s=t.getAttribute("src");if(!e&&!s)throw new Error(l.ERR0020);let r=null,o=null;if(e&&(r=e.trim(),!r))throw new Error(l.ERR0014);if(s&&(o=(await(await fetch(s)).text()).trim(),!o))throw new Error(l.ERR0014);if(r&&o)return`${r}
${o}`;if(r)return r;if(o)return o}var D=d(()=>{"use strict";w();x()});var j={};g(j,{loadTexscriptStyles:()=>le});async function le(){let t=document.querySelector('script[src$="texscript.js"]');if(t instanceof HTMLScriptElement&&t.src){let e=t.src.replace("texscript.js","texscript.css");await ce(e),await pe()}}async function ce(t){try{let e=await fetch(t);if(e){let s=await e.text();if(s){let r=document.createElement("style");r.innerHTML=s,document.head.appendChild(r)}}}catch(e){c(e,"error"),console.log(e)}}async function pe(){let t=document.createElement("meta");t.setAttribute("name","viewport"),t.setAttribute("content","initial-scale=1.0, maximum-scale=1.0, user-scalable=no"),document.head.appendChild(t)}var W=d(()=>{"use strict";w()});var k,A,y,v,Y=d(()=>{"use strict";x();v=class{constructor(e){S(this,k,null);S(this,A,null);S(this,y,null);if(!e)throw new Error(l.ERR0013);C(this,k,e)}start(){C(this,A,performance.now())}end(){C(this,y,performance.now());let e=this.getFormattedTime();console.log(`[Texscript: Metrics] > ${h(this,k)} finished in ${e}`)}getTotalTimeMilliseconds(){return h(this,y)&&h(this,A)?h(this,y)-h(this,A):0}getFormattedTime(){let e=this.getTotalTimeMilliseconds();return e<1e3?`${e.toFixed(3)}ms`:`${(e/1e3).toFixed(3)}s`}};k=new WeakMap,A=new WeakMap,y=new WeakMap});var P,L,_,M,H,b,Q=d(()=>{"use strict";L=class{constructor(e){S(this,P,null);C(this,P,e)}getNodeType(){return h(this,P)}};P=new WeakMap;_=class extends L{constructor(){super("ROOT");this.value=null;this.meta={};this.body=[];this.dependencies={}}},M=class extends L{constructor(){super("TAG");this.value=null;this.htmlElement=null;this.customCSSClasses=[];this.parameters=null;this.children=[]}},H=class extends L{constructor(){super("LITERAL");this.value=null}},b=class extends L{constructor(){super("SPEC_TAG");this.htmlElement=null;this.value=null}}});function ge(t,e){let s=new Map;for(let r of t){let o=r.split("|").map(i=>{let a=e[i];if(!a)throw new Error(`Unknown token: ${i}`);return a.source}),n=new RegExp(o.join(""));s.set(r,n)}return s}var de,ue,me,Ee,Re,he,z,V=d(()=>{"use strict";de={KEYWORD:/(^[A-Z][a-z]*)/,STRING:/"(.*)"$|(\\\"(.*)\\\"$)/},ue={CSS_CLASS:/\.([a-z]+[a-zA-Z]*)/,EXTERNAL_REFERENCE:/(@[A-Z][a-zA-Z]*:\s".*")/,PARAMETERS:/(\([\s*\w+:\s*\w+,*\s*]*\))/},me={BRACKET_SQUARE_CLOSE:/(\])/,BRACKET_SQUARE_OPEN:/(\[)/,COLON:/(:)/,SPACE:/(\s)/},Ee={BR:/(::)/,HR:/(--)/},Re={...de,...ue,...me,...Ee},he=["BR","BRACKET_SQUARE_CLOSE","HR","KEYWORD|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|CSS_CLASS|SPACE|PARAMETERS|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|SPACE|PARAMETERS|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|SPACE|PARAMETERS|COLON|SPACE|STRING","KEYWORD|SPACE|PARAMETERS|SPACE|BRACKET_SQUARE_OPEN","STRING","EXTERNAL_REFERENCE"];z=ge(he,Re)});var f,X=d(()=>{"use strict";f=class{constructor(){this.items=[]}push(e){this.items.push(e)}pop(){if(this.isEmpty())throw new Error("Stack underflow");return this.items.pop()}isEmpty(){return this.items.length===0}size(){return this.items.length}peek(){return this.isEmpty()?null:this.items[this.items.length-1]}}});var Z={};g(Z,{default:()=>$});var $,q=d(()=>{"use strict";Y();x();Q();V();X();$=class{constructor(){this.version="v0.2";this.repourl="https://github.com/M9J/texscript.git";this.metricsCompilation=new v("Compilation");this.metricsCodeGeneration=new v("Code Generation");this.rawCode=null;this.loc=null;this.tokens=null;this.ast=null;console.log(`[Texscript: Info] > Compiler ${this.version}`)}toString(){return{version:this.version,repoURL:this.repourl,lastCompilation:new Map([["loc",this.loc],["tokens",this.tokens],["ast",this.ast]])}}compile(e){this.rawCode=e,this.metricsCompilation.start(),this.loc=this.convertToLinesOfCode(),this.tokens=this.lexicalAnalysis(),this.ast=this.syntaxAnalysis(),this.metricsCompilation.end()}generateCodeFor(e){if(!e)throw new Error(l.ERR0011);this.metricsCodeGeneration.start();let s=null;if(e==="HTML")s=this.generateCodeForHTML();else throw new Error(l.ERR0012);return this.metricsCodeGeneration.end(),s}generateCodeForHTML(){if(!this.ast)throw new Error(l.ERR0009);let e="";for(let s of this.ast.body){let r=s.getNodeType();(r==="TAG"||r==="SPEC_TAG"||r==="LITERAL")&&(e+=this.generateHTMLForNode(s))}return e.trim()}generateHTMLForNode(e){if(!e)throw new Error(l.ERR0010);let s=e.getNodeType(),r=e.value,o=e.htmlElement,n=e.parameters,i=e.customCSSClasses,a=e.children||[],m="",E="";if(Array.isArray(i)&&i.length>0&&(m=` ${i.join(" ")}`),n)for(let p in n){let T=n[p];E+=` texscript-${r}-${p.toUpperCase()}-${T.toUpperCase()}`}return s==="TAG"?`<${o} class="texscript-${r}${m}${E}">
    ${a.filter(p=>{let T=p.getNodeType();return T==="TAG"||T==="SPEC_TAG"||T==="LITERAL"}).map(p=>this.generateHTMLForNode(p)).join("")}
  </${o}>`:s==="SPEC_TAG"?`<${o} class="texscript-${r}"/>`:s==="LITERAL"?`${r}`:""}syntaxAnalysis(){if(!this.tokens)throw new Error(l.ERR0007);let e=new _;e.value="Program",e.meta.languageName="Texscript",e.meta.languageCompilerVersion=this.version;let s=new f,r=new f,o=new f,n=null;for(let i of this.tokens)for(let a of i){if(!a.type)throw new Error(l.ERR0008);switch(a.type){case"BR":let m=new b;m.htmlElement="br",m.value="BR",n==null||n.children.push(m);break;case"BRACKET_SQUARE_CLOSE":{s.isEmpty()||s.pop(),s.isEmpty()||(n=s.isEmpty()?null:s.peek());break}case"BRACKET_SQUARE_OPEN":n&&s.push(n);break;case"COLON":r.push(a);break;case"CSS_CLASS":n==null||n.customCSSClasses.push(a.value);break;case"EXTERNAL_REFERENCE":if(a.value){let u=a.value.replace(/[\@\s\"]/g,""),[N,O]=u.split(":");N==="CustomCSSFilePath"&&(e.dependencies[N]=O)}break;case"HR":let E=new b;E.htmlElement="hr",E.value="HR",n==null||n.children.push(E);break;case"KEYWORD":let p=new M;if(p.value=a.value,p.htmlElement=a.value==="Section"?"section":a.value==="List"?"ul":"div",n=p,s.isEmpty())e.body.push(n);else{let u=s.isEmpty()?null:s.peek();u&&u.children.push(n)}break;case"PARAMETERS":let re=a.value.replace(/[\(\)\s]/g,"").split(",");for(let u of re){let[N,O]=u.split(":");N&&O&&(n!=null&&n.parameters||(n.parameters={}),n.parameters[N]=O)}break;case"SPACE":o.push(a);break;case"STRING":let F=new H;F.value=a.value;let R=new M;if(s.isEmpty())R.value="Line",R.htmlElement="div";else{let u=s.isEmpty()?null:s.peek();(u==null?void 0:u.value)==="List"?(R.value="ListItem",R.htmlElement="li"):(R.value="Line",R.htmlElement="div")}if(R.children.push(F),!n)throw new Error("'currentNode' doesn't exist");n.children.push(R),!r.isEmpty()&&!o.isEmpty()&&(n=s.isEmpty()?null:s.peek(),r.pop(),o.pop());break}}return e}lexicalAnalysis(){if(!this.loc)throw new Error(l.ERR0004);let e=[];for(let[s,r]of this.loc.entries()){let o=!1;for(let[n,i]of z){let a=r.match(i);if(a&&a.length>0){o=!0;let[m,...E]=a;if(m===r){let p=this.convertLineToTokens(n,E);e.push(p);break}}}if(!o){let n=s+1,i=`${l.ERR0017}, line: ${n}<br/>${r}`;throw new Error(i)}}return e}convertLineToTokens(e,s){if(!e)throw new Error(l.ERR0005);if(!s)throw new Error(l.ERR0006);let r=[],o=e.split("|");for(let[n,i]of o.entries()){let a=s[n];a!==void 0&&r.push({type:i,value:a})}return r}convertToLinesOfCode(){if(!this.rawCode)throw new Error(l.ERR0002);return this.rawCode.split(`
`).map(e=>e.trim()).filter(e=>e.length>0)}}});var J={};g(J,{process:()=>fe});async function fe(t,e){try{if(c("Compiling..."),t.compile(e),t.ast){let i=t.ast.dependencies;c("Loading dependencies..."),await Te(i)}let s=t.generateCodeFor("HTML");c("Compilation done.");let r=document.querySelector(".texscript-banner-container");r instanceof HTMLElement&&(r.style.display="none");let o=document.createElement("div");o.className="texscript-pages",o.innerHTML=s;let n=document.createElement("div");n.className="texscript-pages-container",n.appendChild(o),document.body.appendChild(n),window.TexscriptCompiler={...t.toString(),toggleSplash:()=>{let i=document.getElementById("texscript-splash");i&&(i.style.display=i.style.display==="flex"?"none":"flex")}}}catch(s){c(s,"error"),console.log(s)}}async function Te(t){try{if(t!=null&&t.CustomCSSFilePath){let e=t.CustomCSSFilePath;await Se(e)}}catch(e){c(e,"error"),console.log(e)}}async function Se(t){let e=document.createElement("link");e.rel="stylesheet",e.href=t;try{document.head.appendChild(e),await new Promise((s,r)=>{e.onload=()=>s(),e.onerror=()=>{let o=l.ERR0018+"<br/>"+t;r(new Error(o))}})}catch(s){c(s,"error"),console.log(s)}}var ee=d(()=>{"use strict";w();x()});var te={};g(te,{load:()=>Ce});async function Ce(){try{c("Getting handy tools...");let t=await Promise.resolve().then(()=>(D(),I)),e=await Promise.resolve().then(()=>(W(),j));c("Opening curse words...");let s=await Promise.resolve().then(()=>(x(),K));c("Applying beauty makeup..."),await e.loadTexscriptStyles(),c("Loading brain power...");let r=await Promise.resolve().then(()=>(q(),Z)),o=new r.default,n=await Promise.resolve().then(()=>(ee(),J));c("Finding your story...");let i=await t.findCodeFromDOM();if(!i)throw new Error(s.default.ERR0001);n.process(o,i)}catch(t){c(t,"error"),console.log(t)}}var se=d(()=>{"use strict";w()});var ne={};g(ne,{loadSplash:()=>ye,updateSplashStatus:()=>c});async function ye(){try{let t=document.createElement("style");t.innerHTML=Ae,document.head.appendChild(t),document.body.innerHTML=we,c("Fetching Texscript Loader...");let e=await Promise.resolve().then(()=>(se(),te));c("Fetched Texscript Loader"),c("Loading Texscript modules..."),await e.load()}catch(t){c(t,"error"),console.log(t)}}function c(t,e){let s="";e==="error"?s=(n=>`<div class="texscript-splash-status-${n}">${t}</div>`)("error"):s=t;let o=document.getElementById("texscript-splash-status");if(o&&(i=>{o.innerHTML+=i+"<br/>"})(s),e&&["error"].includes(e)){let n=document.getElementById("texscript-splash");n&&(n.style.display="flex")}}var xe,we,Ae,w=d(()=>{"use strict";xe='Texscript Markup Language [Version 0.2]<br/>Free and Open Source. Licensed under GPL-3.0.<br/>Hosted on GitHub: <a href="https://github.com/M9J/texscript.git">texscript.git</a>',we=`
<div class="texscript-splash-container" id="texscript-splash">
  <div class="texscript-banner">
    <div>${xe}</div>
    <br/>
    <div>$&gt; texscript run</div>
    <br/>
    <div id="texscript-splash-status"></div>
  </div>
</div>
`,Ae=`
.texscript-splash-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;  
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  background: #252529;
  margin: 0;
  box-sizing: border-box;
  display: none;
}

.texscript-banner {
  font-family: monospace;
  background: #fff;
  color: #000;
  padding: 16px;
  box-shadow: -4px -8px 16px rgba(0, 0, 0, 0.5);
  box-sizing: border-box;
}

.texscript-splash-status {
  overflow: auto;
}

.texscript-splash-status-error {
  color: #a00;
}
`});async function We(){await(await Promise.resolve().then(()=>(w(),ne))).loadSplash()}export{We as load};
