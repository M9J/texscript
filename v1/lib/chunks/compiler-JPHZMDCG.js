import{a as m}from"./chunk-DPMWTBQQ.js";import{a as i,b as R,c as f,d as S}from"./chunk-2SS7LSZN.js";var T,w,g,C=class{constructor(e){f(this,T,null);f(this,w,null);f(this,g,null);if(!e)throw new Error(m.ERR0013);S(this,T,e)}start(){S(this,w,performance.now())}end(){S(this,g,performance.now());let e=this.getFormattedTime();console.log(`[Texscript: Metrics] > ${R(this,T)} finished in ${e}`)}getTotalTimeMilliseconds(){return R(this,g)-R(this,w)}getFormattedTime(){let e=this.getTotalTimeMilliseconds();return e<1e3?`${e.toFixed(3)}ms`:`${(e/1e3).toFixed(3)}s`}};T=new WeakMap,w=new WeakMap,g=new WeakMap;var O,A=class{constructor(e){f(this,O,null);S(this,O,e)}getNodeType(){return R(this,O)}};O=new WeakMap;var N=class extends A{constructor(){super("ROOT");i(this,"value",null);i(this,"meta",{});i(this,"body",[]);i(this,"dependencies",{})}},L=class extends A{constructor(){super("TAG");i(this,"value",null);i(this,"htmlElement",null);i(this,"customCSSClasses",[]);i(this,"parameters",null);i(this,"children",[])}},v=class extends A{constructor(){super("LITERAL");i(this,"value",null)}},k=class extends A{constructor(){super("SPEC_TAG");i(this,"htmlElement",null);i(this,"value",null)}};var $={KEYWORD:/(^[A-Z][a-z]*)/,STRING:/\"(.*)\"$|(\\\"(.*)\\\"$)/},b={CSS_CLASS:/\.([a-z]+[a-zA-Z]*)/,EXTERNAL_REFERENCE:/(\@[A-Z][a-zA-Z]*\:\s\".*\")/,PARAMETERS:/(\([\s*\w+\:\s*\w+\,*\s*]*\))/},K={BRACKET_SQUARE_CLOSE:/(\])/,BRACKET_SQUARE_OPEN:/(\[)/,COLON:/(\:)/,SPACE:/(\s)/},G={BR:/(\:\:)/,HR:/(\-\-)/},B={...$,...b,...K,...G},F=["BR","BRACKET_SQUARE_CLOSE","HR","KEYWORD|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|CSS_CLASS|SPACE|PARAMETERS|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|SPACE|PARAMETERS|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|SPACE|PARAMETERS|COLON|SPACE|STRING","KEYWORD|SPACE|PARAMETERS|SPACE|BRACKET_SQUARE_OPEN","STRING","EXTERNAL_REFERENCE"];function U(p,e){let s=new Map;for(let a of p){let t=a.split("|").map(E=>e[E].source),c=new RegExp(t.join(""));s.set(a,c)}return s}var x=U(F,B);var u=class{constructor(){this.items=[]}push(e){this.items.push(e)}pop(){if(this.isEmpty())throw new Error("Stack underflow");return this.items.pop()}isEmpty(){return this.items.length===0}size(){return this.items.length}peek(){if(this.isEmpty())throw new Error("Stack is empty");return this.items[this.items.length-1]}};var M=class{constructor(){i(this,"version","v0.1");i(this,"repourl","https://github.com/M9J/texscript.git");i(this,"metricsCompilation",new C("Compilation"));i(this,"metricsCodeGeneration",new C("CodeGeneration"));i(this,"rawCode",null);i(this,"loc",null);i(this,"tokens",null);i(this,"ast",null);console.log(`[Texscript: Info] > Compiler ${this.version}`)}toString(){return{version:this.version,repoURL:this.repourl,lastCompilation:new Map([["loc",this.loc],["tokens",this.tokens],["ast",this.ast]])}}compile(e){this.rawCode=e,this.metricsCompilation.start(),this.loc=this.convertToLinesOfCode(),this.tokens=this.lexicalAnalysis(),this.ast=this.syntaxAnalysis(),this.metricsCompilation.end()}generateCodeFor(e){if(!e)throw new Error(m.ERR0011);this.metricsCodeGeneration.start();let s=null;if(e==="HTML")s=this.generateCodeForHTML();else throw new Error(m.ERR0012);return this.metricsCodeGeneration.end(),s}generateCodeForHTML(){let e=this.ast;if(!e)throw new Error(m.ERR0009);let s="",a=e.body;if(a)for(let t of a)s+=this.generateHTMLForNode(t);return s.trim()}generateHTMLForNode(e){if(!e)throw new Error(m.ERR0010);let s=e.getNodeType(),a=e.value,t=e.parameters,c=e.htmlElement,E=e.customCSSClasses,r="",h="",y=Array.isArray(E)?E.length>0:!1,l=t||!1;if(y&&(r=` ${E.join(" ")}`),l)for(let n in t){let d=t[n];h+=` texscript-${a}-${n.toUpperCase()}-${d.toUpperCase()}`}let o=e.children||[];if(s==="TAG")return`<${c} class="texscript-${a}${r}${h}">
          ${o.length>0&&o.map(n=>this.generateHTMLForNode(n)).join("")}
      </${c}>
      `;if(s==="SPEC_TAG")return`<${c} class="texscript-${a}"/>`;if(s==="LITERAL")return`${a}`}syntaxAnalysis(){let e=this.tokens;if(!e)throw new Error(m.ERR0007);let s=new N;s.value="Program",s.meta.languageName="Texscript",s.meta.languageCompilerVersion=this.version;let a=Array.isArray(e)?e.length>0:!1,[t,c,E]=[new u,new u,new u];if(a){let r=null;for(let h of e)if(Array.isArray(h)?h.length>0:!1)for(let l of h){if(!l.type)throw new Error(m.ERR0008);switch(l.type){case"BR":{let o=new k;o.htmlElement="br",o.value="BR",r.children.push(o);break}case"BRACKET_SQUARE_CLOSE":{t.isEmpty()||t.pop(),t.isEmpty()||(r=t.peek());break}case"BRACKET_SQUARE_OPEN":{t.push(r);break}case"COLON":{c.push(l);break}case"CSS_CLASS":{r.customCSSClasses.push(l.value);break}case"EXTERNAL_REFERENCE":{if(l.value){let o=l.value.replace(/[\@\s\"]/g,""),[n,d]=o.split(":");n==="CustomCSSFilePath"&&(s.dependencies[n]=d)}break}case"HR":{let o=new k;o.htmlElement="hr",o.value="HR",r.children.push(o);break}case"KEYWORD":{let o=new L;if(o.value=l.value,l.value==="Section"?o.htmlElement="section":l.value==="List"?o.htmlElement="ul":o.htmlElement="div",r=o,t.isEmpty())s.body.push(r);else{let n=t.peek();n&&n.children.push(r)}break}case"PARAMETERS":{let n=l.value.replace(/[\(\)\s]/g,"").split(",");for(let d of n){let[P,_]=d.split(":");r.parameters||(r.parameters={}),r.parameters[P]=_}break}case"SPACE":{E.push(l);break}case"STRING":{let o=new v;o.value=l.value;let n=new L;if(t.isEmpty()?(n.value="Line",n.htmlElement="div"):t.peek().value==="List"?(n.value="ListItem",n.htmlElement="li"):(n.value="Line",n.htmlElement="div"),n.children.push(o),!r)throw new Error("'currentNode' doesn't exist");r.children.push(n),!c.isEmpty()&&!E.isEmpty()&&(t.isEmpty()||(r=t.peek()),c.pop(),E.pop());break}}}}return s}lexicalAnalysis(){let e=this.loc;if(!e)throw new Error(m.ERR0004);let s=[];for(let[a,t]of e.entries()){let c=!1;for(let[E,r]of x){let h=t.match(r);if(Array.isArray(h)?h.length>0:!1){c=!0;let[l,...o]=h;if(l===t){let n=this.convertLineToTokens(E,o);s.push(n);break}}}if(!c){let E=a+1,r=`${m.ERR0017}, line: ${E}<br/>${t}`;throw new Error(r)}}return s}convertLineToTokens(e,s){if(!e)throw new Error(m.ERR0005);if(!s)throw new Error(m.ERR0006);let a=[],t=e.split("|");for(let[c,E]of t.entries())if(c<s.length){let r={};r.type=E,r.value=s[c],a.push(r)}return a}convertToLinesOfCode(){let e=this.rawCode;if(!e)throw new Error(m.ERR0002);return e.split(`
`).map(t=>t.trim()).filter(t=>t.length>0)}};export{M as default};
