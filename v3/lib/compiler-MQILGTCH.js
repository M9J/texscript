import{a as C}from"./chunk-ECR4D2RS.js";import"./chunk-Y4YNR2UE.js";import"./chunk-J7FAPHSG.js";import{a as E}from"./chunk-5G3KPQK6.js";import{a as L,b as k,c as v}from"./chunk-GKXYOKXO.js";var d,A=class{constructor(e){k(this,d,null);v(this,d,e)}getNodeType(){return L(this,d)}};d=new WeakMap;var f=class extends A{constructor(){super("ROOT");this.value=null;this.meta={};this.body=[];this.dependencies={};this.references={};this.configurations={}}},m=class extends A{constructor(){super("TAG");this.value=null;this.htmlElement=null;this.customCSSClasses=[];this.parameters=null;this.children=[];this.htmlAttributes={}}},T=class extends A{constructor(){super("LITERAL");this.value=null}},S=class extends A{constructor(){super("SPEC_TAG");this.htmlElement=null;this.value=null}};var M={KEYWORD:/(^[A-Z][a-z]*)/,STRING:/"(.*)"$|(\\\"(.*)\\\"$)/},y={CSS_CLASS:/\.([a-z]+[a-zA-Z]*)/,COMMAND:/(@[A-Z][a-zA-Z]*\s[\s\w]+:\s*("[^"]*"|\w+))/,PARAMETERS:/(\(([\s\w]+:\s*("[^"]*"|\w+),?\s*)+\))/,URL:/^\"(?:https?:\/\/|\/\/|www\.)?[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}(?:\.[a-zA-Z]{2,})?\"$/,MAIL:/^\"[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}\"$/},O={BRACKET_SQUARE_CLOSE:/(\])/,BRACKET_SQUARE_OPEN:/(\[)/,COLON:/(:)/,SPACE:/(\s*)/,WHITESPACE:/(\s)/,BRACKET_ANGLE_CLOSE:/(\>)/,DOUBLE_QUOTE:/(\")/},x={BR:/(::)/,HR:/(--)/},P={...M,...y,...O,...x},_=["BR","BRACKET_SQUARE_CLOSE","COMMAND","HR","MAIL","KEYWORD|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|CSS_CLASS|SPACE|PARAMETERS|COLON|SPACE|STRING","KEYWORD|CSS_CLASS|SPACE|PARAMETERS|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|SPACE|BRACKET_SQUARE_OPEN","KEYWORD|SPACE|PARAMETERS","KEYWORD|SPACE|PARAMETERS|COLON|SPACE|STRING","KEYWORD|SPACE|PARAMETERS|SPACE|BRACKET_SQUARE_OPEN","URL","STRING"];function b(h,e){let n=new Map;for(let a of h){let c=a.split("|").map(p=>{let o=e[p];if(!o)throw new Error(`Unknown token: ${p}`);return o.source}),t=new RegExp(c.join(""));n.set(a,t)}return n}var N=b(_,P);var g=class{constructor(){this.items=[]}push(e){this.items.push(e)}pop(){if(this.isEmpty())throw new Error("Stack underflow");return this.items.pop()}isEmpty(){return this.items.length===0}size(){return this.items.length}peek(){return this.isEmpty()?null:this.items[this.items.length-1]}};var w=class{constructor(){this.version="v0.2";this.repourl="https://github.com/M9J/texscript.git";this.metricsCompilation=new C("Texscript Compilation");this.metricsCodeGeneration=new C("Texscript Code Generation");this.rawCode=null;this.loc=null;this.tokens=null;this.ast=null;console.log(`[Texscript: Info] > Compiler ${this.version}`)}get lastCompilation(){return new Map([["loc",this.loc],["tokens",this.tokens],["ast",this.ast]])}toString(){return{version:this.version,repoURL:this.repourl,lastCompilation:this.lastCompilation,grammar:N}}compile(e){this.rawCode=e,this.metricsCompilation.start(),this.loc=this.convertToLinesOfCode(),this.tokens=this.lexicalAnalysis(),this.ast=this.syntaxAnalysis(),this.metricsCompilation.end()}generateCodeFor(e){if(!e)throw new Error(E.ERR0011);this.metricsCodeGeneration.start();let n=null;if(e==="HTML")n=this.generateCodeForHTML();else throw new Error(E.ERR0012);return this.metricsCodeGeneration.end(),n}generateCodeForHTML(){if(!this.ast)throw new Error(E.ERR0009);let e="";for(let n of this.ast.body){let a=n.getNodeType();(a==="TAG"||a==="SPEC_TAG"||a==="LITERAL")&&(e+=this.generateHTMLForNode(n))}return e.trim()}generateHTMLForNode(e){if(!e)throw new Error(E.ERR0010);let n=e.getNodeType(),a=e.value,c=e.htmlElement,t=e.htmlAttributes,p=e.parameters,o=e.customCSSClasses,r=e.children||[],s="",i="",u="";if(Array.isArray(o)&&o.length>0&&(s=` ${o.join(" ")}`),p)for(let l in p){let R=p[l];i+=` texscript-${a}-${l.toUpperCase()}-${R.toUpperCase()}`}if(t)for(let l in t){let R=t[l];u+=` ${l}="${R}"`}return n==="TAG"?`<${c} class="texscript-${a}${s}${i}" ${u}>
    ${r.filter(l=>{let R=l.getNodeType();return R==="TAG"||R==="SPEC_TAG"||R==="LITERAL"}).map(l=>this.generateHTMLForNode(l)).join("")}
  </${c}>`:n==="SPEC_TAG"?`<${c} class="texscript-${a}"/>`:n==="LITERAL"?`${a}`:""}syntaxAnalysis(){if(!this.tokens)throw new Error(E.ERR0007);let e=new f;e.value="Program",e.meta.languageName="Texscript",e.meta.languageCompilerVersion=this.version;let n=new g,a=new g,c=new g,t=null;for(let p of this.tokens)for(let o of p){if(!o.type)throw new Error(E.ERR0008);switch(o.type){case"BR":{let r=new S;r.htmlElement="br",r.value="BR",t==null||t.children.push(r);break}case"BRACKET_SQUARE_CLOSE":{n.isEmpty()||n.pop(),n.isEmpty()||(t=n.isEmpty()?null:n.peek());break}case"BRACKET_SQUARE_OPEN":{t&&n.push(t);break}case"COLON":{a.push(o);break}case"COMMAND":{if(o.value){let[r,s]=o.value.split(":");if(r){let[i,u]=r==null?void 0:r.split(" ");if(i&&u&&s){if(i==="@Reference"){let l=s.replace(/[\@\s\"]/g,"");e.references[u]=e.references[u]?[...e.references[u],l]:[l]}else if(i==="@Configure"){let l=s.replace(/[\@\s\"]/g,"");e.configurations[u]=l}}}}break}case"CSS_CLASS":{t==null||t.customCSSClasses.push(o.value);break}case"HR":{let r=new S;r.htmlElement="hr",r.value="HR",t==null||t.children.push(r);break}case"MAIL":case"URL":{let r=new m,s=new T;r.htmlElement="a",r.value="Line";let i=o.value.replace(/\"/g,"");if(o.type==="MAIL"&&(r.htmlAttributes.href="mailto:"+i),o.type==="URL"){let u=l=>l.replace(/^(?!https?:\/\/)/i,"http://");r.htmlAttributes.href=u(i),r.htmlAttributes.target="_blank"}s.value=i,r.children.push(s),t&&(t==null||t.children.push(r));break}case"KEYWORD":{let r=new m;if(r.value=o.value,r.htmlElement=o.value==="Section"?"section":o.value==="List"?"ul":"div",t=r,n.isEmpty())if(e.body.length>0){let s=new m;s.value="PageBreak",s.htmlElement="div",e.body.push(s);let i=new m;i.value="PageWrapper",i.htmlElement="div",i.children.push(t),e.body.push(i)}else{let s=new m;s.value="PageWrapper",s.htmlElement="div",s.children.push(t),e.body.push(s)}else{let s=n.isEmpty()?null:n.peek();s&&s.children.push(t)}break}case"PARAMETERS":{let s=o.value.replace(/[\(\)\s]/g,"").split(",");for(let i of s){let[u,l]=i.split(":");u&&l&&(t!=null&&t.parameters||(t.parameters={}),t.parameters[u]=l)}break}case"SPACE":case"SPACE_OPTIONAL":{c.push(o);break}case"STRING":{let r=new T;r.value=o.value;let s=new m;if(n.isEmpty())s.value="Line",s.htmlElement="div";else{let i=n.isEmpty()?null:n.peek();(i==null?void 0:i.value)==="List"?(s.value="ListItem",s.htmlElement="li"):(s.value="Line",s.htmlElement="div")}if(s.children.push(r),!t)throw new Error("'currentNode' doesn't exist");t.children.push(s),!a.isEmpty()&&!c.isEmpty()&&(t=n.isEmpty()?null:n.peek(),a.pop(),c.pop());break}}}return e}lexicalAnalysis(){if(!this.loc)throw new Error(E.ERR0004);let e=[];for(let[n,a]of this.loc.entries()){let c=!1;for(let[t,p]of N){let o=a.match(p);if(o&&o.length>0){c=!0;let[r,...s]=o;if(r===a){let i=this.convertLineToTokens(t,s.length?s:[r]);e.push(i);break}}}if(!c){let t=n+1,p=`${E.ERR0017}, line: ${t}
${a}`;throw new Error(p)}}return e}convertLineToTokens(e,n){if(!e)throw new Error(E.ERR0005);if(!n)throw new Error(E.ERR0006);let a=[],c=e.split("|");for(let[t,p]of c.entries()){let o=n[t];o!==void 0&&a.push({type:p,value:o})}return a}convertToLinesOfCode(){if(!this.rawCode)throw new Error(E.ERR0002);return this.rawCode.split(`
`).map(e=>e.trim()).filter(e=>e.length>0)}};export{w as default};
