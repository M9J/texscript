import{a as c}from"./chunk-ECR4D2RS.js";import{b as l,c as f}from"./chunk-Y4YNR2UE.js";import{a as y}from"./chunk-J7FAPHSG.js";import{a as x}from"./chunk-5G3KPQK6.js";import"./chunk-GKXYOKXO.js";var g=class{constructor(){this.metricsCSSBuilder=new c("CSS Builder");this.CSSConfig={classes:{},globalRules:[]}}addStyle(e,i,n){this.CSSConfig.classes[e]||(this.CSSConfig.classes[e]={}),this.CSSConfig.classes[e][i]=n}addGlobalRule(e){this.CSSConfig.globalRules.push(e)}buildCSS(){this.metricsCSSBuilder.start();let e=Object.entries(this.CSSConfig.classes).map(([n,a])=>{let s=Object.entries(a).map(([o,r])=>`${o}: ${r};`).join(" ");return`${n} { ${s} }`}).join(`
`),i=this.CSSConfig.globalRules.join(`
`);return this.metricsCSSBuilder.end(),`${e}
${i}`}};function u(t){let e=document.createElement("style");e.textContent=t,document.head.appendChild(e)}var C={pageSize:"",pagePadding:"",lineHeight:"normal"};var P=.0393701,b={A0:{width:841,height:1189},A1:{width:594,height:841},A2:{width:420,height:594},A3:{width:297,height:420},A4:{width:210,height:297},A5:{width:148,height:210},A6:{width:105,height:148},B0:{width:1e3,height:1414},B1:{width:707,height:1e3},B2:{width:500,height:707},B3:{width:353,height:500},B4:{width:250,height:353},B5:{width:176,height:250},C4:{width:229,height:324},C5:{width:162,height:229},C6:{width:114,height:162}};function T(t,e="mm"){let i=b[t.toUpperCase()];if(!i)return null;switch(e){case"px":return{width:Math.round(i.width*3.779527),height:Math.round(i.height*3.779527)};case"in":return{width:parseFloat((i.width*P).toFixed(2)),height:parseFloat((i.height*P).toFixed(2))};case"mm":default:return i}}var d=new g;async function M(t){if(t){await B(t.pageSize),await v(t.pagePadding),await j(t.lineHeight);let e=d.buildCSS();u(e)}}async function j(t=C.lineHeight){t&&d.addStyle(".texscript-Page","line-height",t)}async function v(t=C.pagePadding){t&&t&&d.addStyle(".texscript-PageWrapper","padding",t)}async function B(t=C.pageSize){if(t){let i=T(t,"in");i&&i.width&&i.height&&(d.addGlobalRule(`@media print { @page { size: ${t}} }`),d.addStyle(".texscript-PageWrapper","width",i.width+"in"),d.addStyle(".texscript-PageWrapper","height",i.height+"in"))}}var H=[{href:"https://fonts.googleapis.com",crossorigin:!1},{href:"https://fonts.gstatic.com",crossorigin:!0}];function E(){for(let t of H){let e=document.createElement("link");e.rel="preconnect",e.href=t.href,t.crossorigin&&(e.crossOrigin="anonymous"),document.head.appendChild(e)}}var _=["align-items","color","display","flex-direction","font-family","font-size","font-weight","justify-content","padding-left","text-align"],S=class{constructor(){this.metricsCSSFilterCompiler=new c("CSS Filter Compiler");this.allowedProperties=_}compile(e){this.metricsCSSFilterCompiler.start();let i={classes:[],imports:[]},n=/@import\s+(?:url\()?["']?([^"')]+)["']?\)?\s*;/g,a;for(;(a=n.exec(e))!==null;){let r=a[1];typeof r=="string"&&r.trim()&&i.imports.push(r.trim())}let s=/((?:\.[a-zA-Z0-9_-]+\s*,?\s*)+)\{([^}]+)\}/g,o;for(;(o=s.exec(e))!==null;){let r=o[1],m=o[2],h=[];m&&m.split(";").forEach(w=>{let[p,L]=w.split(":").map(A=>A.trim());this.allowedProperties.includes(p)&&h.push({property:p,value:L})}),r&&r.split(",").map(p=>p.trim()).forEach(p=>{p.startsWith(".")&&i.classes.push({selector:p,declarations:[...h]})})}return this.metricsCSSFilterCompiler.end(),i}generateFilteredCSSContent(e){var a;if(!e)return"";let i=((a=e.imports)==null?void 0:a.map(s=>`@import url("${s}");`))||[],n=e.classes.map(s=>{let o=s.declarations.map(r=>`  ${r.property}: ${r.value};`).join(`
`);return`${s.selector} {
${o}
}`});return[...i,...n].join(`

`)}};async function R(t){let e=new c("CSS File Loader");e.start();for(let i of t){let n=await fetch(i);if(n.status===404)throw new Error(x.ERR0022+": "+i);let a=await n.text();if(a){let s=new S,o=s.compile(a),r=s.generateFilteredCSSContent(o);u(r)}}e.end()}async function F(){let t=document.querySelector('script[src$="texscript.js"]');if(t instanceof HTMLScriptElement&&t.src){let e=t.src.replace("texscript.js","texscript.css");await $(e),await z()}}async function $(t){try{let e=await fetch(t);if(e){let i=await e.text();if(i){let n=document.createElement("style");n.innerHTML=i,document.head.appendChild(n)}}}catch(e){l(e,"error")}}async function z(){let t=document.createElement("meta");t.setAttribute("name","viewport"),t.setAttribute("content","width=device-width, initial-scale=1.0"),document.head.appendChild(t)}async function mt(t,e){try{let i=new c("Texscript Process");if(i.start(),l("Compiling..."),t.compile(e),await F(),t.ast){let m=t.ast.configurations;m&&(l("Loading configurations..."),await k(m),f("95"));let h=t.ast.references;h&&(l("Loading references..."),await O(h),f("98"))}let n=t.generateCodeFor("HTML");l("Compilation done.");let a=document.querySelector(".texscript-banner-container");a instanceof HTMLElement&&(a.style.display="none");let s=document.createElement("div");s.className="texscript-pages",s.innerHTML=n;let o=document.createElement("div");o.className="texscript-pages-container",o.classList.add("display-none"),o.appendChild(s);let r=y();r.innerHTML=o.outerHTML,await document.fonts.ready,o.classList.remove("display-none"),f("100"),i.end(),window.TexscriptCompiler=t.toString(),D()}catch(i){l(i,"error")}}async function O(t){t&&(E(),t.css&&await R(t.css))}async function k(t){t&&await M(t)}function D(){(!document.title||document.title.trim()==="")&&(document.title="Texscript | "+location.host+location.pathname);let t=document.documentElement;(!t.lang||t.lang.trim()==="")&&(t.lang="en");let e=document.querySelector('meta[name="description"]');e?(!e.content||e.content.trim()==="")&&(e.content="This page was compiled by Texscript Compiler"):(e=document.createElement("meta"),e.name="description",e.content="This page was compiled by Texscript Compiler",document.head.appendChild(e))}export{mt as process};
